<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
  <title>Jacqueline Wingen: A robust method to estimate future frost risks</title>




  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Jacqueline Wingen: A robust method to estimate future frost risks"/>
  <meta property="og:type" content="article"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:site_name" content="Jacqueline Wingen"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Jacqueline Wingen: A robust method to estimate future frost risks"/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","output"]}},"value":[{"type":"character","attributes":{},"value":["A robust method to estimate future frost risks"]},{"type":"character","attributes":{},"value":["distill::distill_article"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  <!--radix_placeholder_navigation_in_header-->
  <meta name="distill:offset" content=""/>

  <script type="application/javascript">

    window.headroom_prevent_pin = false;

    window.document.addEventListener("DOMContentLoaded", function (event) {

      // initialize headroom for banner
      var header = $('header').get(0);
      var headerHeight = header.offsetHeight;
      var headroom = new Headroom(header, {
        tolerance: 5,
        onPin : function() {
          if (window.headroom_prevent_pin) {
            window.headroom_prevent_pin = false;
            headroom.unpin();
          }
        }
      });
      headroom.init();
      if(window.location.hash)
        headroom.unpin();
      $(header).addClass('headroom--transition');

      // offset scroll location for banner on hash change
      // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
      window.addEventListener("hashchange", function(event) {
        window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
      });

      // responsive menu
      $('.distill-site-header').each(function(i, val) {
        var topnav = $(this);
        var toggle = topnav.find('.nav-toggle');
        toggle.on('click', function() {
          topnav.toggleClass('responsive');
        });
      });

      // nav dropdowns
      $('.nav-dropbtn').click(function(e) {
        $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
        $(this).parent().siblings('.nav-dropdown')
           .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $("body").click(function(e){
        $('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $(".nav-dropdown").click(function(e){
        e.stopPropagation();
      });
    });
  </script>

  <style type="text/css">

  /* Theme (user-documented overrideables for nav appearance) */

  .distill-site-nav {
    color: rgba(255, 255, 255, 0.8);
    background-color: #0F2E3D;
    font-size: 15px;
    font-weight: 300;
  }

  .distill-site-nav a {
    color: inherit;
    text-decoration: none;
  }

  .distill-site-nav a:hover {
    color: white;
  }

  @media print {
    .distill-site-nav {
      display: none;
    }
  }

  .distill-site-header {

  }

  .distill-site-footer {

  }


  /* Site Header */

  .distill-site-header {
    width: 100%;
    box-sizing: border-box;
    z-index: 3;
  }

  .distill-site-header .nav-left {
    display: inline-block;
    margin-left: 8px;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header .nav-left {
      margin-left: 0;
    }
  }


  .distill-site-header .nav-right {
    float: right;
    margin-right: 8px;
  }

  .distill-site-header a,
  .distill-site-header .title {
    display: inline-block;
    text-align: center;
    padding: 14px 10px 14px 10px;
  }

  .distill-site-header .title {
    font-size: 18px;
    min-width: 150px;
  }

  .distill-site-header .logo {
    padding: 0;
  }

  .distill-site-header .logo img {
    display: none;
    max-height: 20px;
    width: auto;
    margin-bottom: -4px;
  }

  .distill-site-header .nav-image img {
    max-height: 18px;
    width: auto;
    display: inline-block;
    margin-bottom: -3px;
  }



  @media screen and (min-width: 1000px) {
    .distill-site-header .logo img {
      display: inline-block;
    }
    .distill-site-header .nav-left {
      margin-left: 20px;
    }
    .distill-site-header .nav-right {
      margin-right: 20px;
    }
    .distill-site-header .title {
      padding-left: 12px;
    }
  }


  .distill-site-header .nav-toggle {
    display: none;
  }

  .nav-dropdown {
    display: inline-block;
    position: relative;
  }

  .nav-dropdown .nav-dropbtn {
    border: none;
    outline: none;
    color: rgba(255, 255, 255, 0.8);
    padding: 16px 10px;
    background-color: transparent;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
    margin-top: 1px;
    z-index: 2;
  }

  .nav-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 200px;
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 4px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
    z-index: 1;
    margin-top: 2px;
    white-space: nowrap;
    padding-top: 4px;
    padding-bottom: 4px;
  }

  .nav-dropdown-content hr {
    margin-top: 4px;
    margin-bottom: 4px;
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .nav-dropdown-active {
    display: block;
  }

  .nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
    color: black;
    padding: 6px 24px;
    text-decoration: none;
    display: block;
    text-align: left;
  }

  .nav-dropdown-content .nav-dropdown-header {
    display: block;
    padding: 5px 24px;
    padding-bottom: 0;
    text-transform: uppercase;
    font-size: 14px;
    color: #999999;
    white-space: nowrap;
  }

  .nav-dropdown:hover .nav-dropbtn {
    color: white;
  }

  .nav-dropdown-content a:hover {
    background-color: #ddd;
    color: black;
  }

  .nav-right .nav-dropdown-content {
    margin-left: -45%;
    right: 0;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
    .distill-site-header a.nav-toggle {
      float: right;
      display: block;
    }
    .distill-site-header .title {
      margin-left: 0;
    }
    .distill-site-header .nav-right {
      margin-right: 0;
    }
    .distill-site-header {
      overflow: hidden;
    }
    .nav-right .nav-dropdown-content {
      margin-left: 0;
    }
  }


  @media screen and (max-width: 768px) {
    .distill-site-header.responsive {position: relative; min-height: 500px; }
    .distill-site-header.responsive a.nav-toggle {
      position: absolute;
      right: 0;
      top: 0;
    }
    .distill-site-header.responsive a,
    .distill-site-header.responsive .nav-dropdown {
      display: block;
      text-align: left;
    }
    .distill-site-header.responsive .nav-left,
    .distill-site-header.responsive .nav-right {
      width: 100%;
    }
    .distill-site-header.responsive .nav-dropdown {float: none;}
    .distill-site-header.responsive .nav-dropdown-content {position: relative;}
    .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
      display: block;
      width: 100%;
      text-align: left;
    }
  }

  /* Site Footer */

  .distill-site-footer {
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    z-index: 3;
    margin-top: 30px;
    padding-top: 30px;
    padding-bottom: 30px;
    text-align: center;
  }

  /* Headroom */

  d-title {
    padding-top: 6rem;
  }

  @media print {
    d-title {
      padding-top: 4rem;
    }
  }

  .headroom {
    z-index: 1000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }

  .headroom--transition {
    transition: all .4s ease-in-out;
  }

  .headroom--unpinned {
    top: -100px;
  }

  .headroom--pinned {
    top: 0;
  }

  /* adjust viewport for navbar height */
  /* helps vertically center bootstrap (non-distill) content */
  .min-vh-100 {
    min-height: calc(100vh - 100px) !important;
  }

  </style>

  <script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <link href="site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"/>
  <link href="site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"/>
  <script src="site_libs/headroom-0.9.4/headroom.min.js"></script>
  <script src="site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
  <script src="site_libs/fuse-6.4.1/fuse.min.js"></script>

  <script type="application/javascript">

  function getMeta(metaName) {
    var metas = document.getElementsByTagName('meta');
    for (let i = 0; i < metas.length; i++) {
      if (metas[i].getAttribute('name') === metaName) {
        return metas[i].getAttribute('content');
      }
    }
    return '';
  }

  function offsetURL(url) {
    var offset = getMeta('distill:offset');
    return offset ? offset + '/' + url : url;
  }

  function createFuseIndex() {

    // create fuse index
    var options = {
      keys: [
        { name: 'title', weight: 20 },
        { name: 'categories', weight: 15 },
        { name: 'description', weight: 10 },
        { name: 'contents', weight: 5 },
      ],
      ignoreLocation: true,
      threshold: 0
    };
    var fuse = new window.Fuse([], options);

    // fetch the main search.json
    return fetch(offsetURL('search.json'))
      .then(function(response) {
        if (response.status == 200) {
          return response.json().then(function(json) {
            // index main articles
            json.articles.forEach(function(article) {
              fuse.add(article);
            });
            // download collections and index their articles
            return Promise.all(json.collections.map(function(collection) {
              return fetch(offsetURL(collection)).then(function(response) {
                if (response.status === 200) {
                  return response.json().then(function(articles) {
                    articles.forEach(function(article) {
                      fuse.add(article);
                    });
                  })
                } else {
                  return Promise.reject(
                    new Error('Unexpected status from search index request: ' +
                              response.status)
                  );
                }
              });
            })).then(function() {
              return fuse;
            });
          });

        } else {
          return Promise.reject(
            new Error('Unexpected status from search index request: ' +
                        response.status)
          );
        }
      });
  }

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // get search element (bail if we don't have one)
    var searchEl = window.document.getElementById('distill-search');
    if (!searchEl)
      return;

    createFuseIndex()
      .then(function(fuse) {

        // make search box visible
        searchEl.classList.remove('hidden');

        // initialize autocomplete
        var options = {
          autoselect: true,
          hint: false,
          minLength: 2,
        };
        window.autocomplete(searchEl, options, [{
          source: function(query, callback) {
            const searchOptions = {
              isCaseSensitive: false,
              shouldSort: true,
              minMatchCharLength: 2,
              limit: 10,
            };
            var results = fuse.search(query, searchOptions);
            callback(results
              .map(function(result) { return result.item; })
            );
          },
          templates: {
            suggestion: function(suggestion) {
              var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
                ? `<img src="${offsetURL(suggestion.preview)}"</img>`
                : '';
              var html = `
                <div class="search-item">
                  <h3>${suggestion.title}</h3>
                  <div class="search-item-description">
                    ${suggestion.description || ''}
                  </div>
                  <div class="search-item-preview">
                    ${img}
                  </div>
                </div>
              `;
              return html;
            }
          }
        }]).on('autocomplete:selected', function(event, suggestion) {
          window.location.href = offsetURL(suggestion.path);
        });
        // remove inline display style on autocompleter (we want to
        // manage responsive display via css)
        $('.algolia-autocomplete').css("display", "");
      })
      .catch(function(error) {
        console.log(error);
      });

  });

  </script>

  <style type="text/css">

  .nav-search {
    font-size: x-small;
  }

  /* Algolioa Autocomplete */

  .algolia-autocomplete {
    display: inline-block;
    margin-left: 10px;
    vertical-align: sub;
    background-color: white;
    color: black;
    padding: 6px;
    padding-top: 8px;
    padding-bottom: 0;
    border-radius: 6px;
    border: 1px #0F2E3D solid;
    width: 180px;
  }


  @media screen and (max-width: 768px) {
    .distill-site-nav .algolia-autocomplete {
      display: none;
      visibility: hidden;
    }
    .distill-site-nav.responsive .algolia-autocomplete {
      display: inline-block;
      visibility: visible;
    }
    .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
      margin-left: 0;
      width: 400px;
      max-height: 400px;
    }
  }

  .algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
    width: 90%;
    outline: none;
    border: none;
  }

  .algolia-autocomplete .aa-hint {
    color: #999;
  }
  .algolia-autocomplete .aa-dropdown-menu {
    width: 550px;
    max-height: 70vh;
    overflow-x: visible;
    overflow-y: scroll;
    padding: 5px;
    margin-top: 3px;
    margin-left: -150px;
    background-color: #fff;
    border-radius: 5px;
    border: 1px solid #999;
    border-top: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
    cursor: pointer;
    padding: 5px 4px;
    border-bottom: 1px solid #eee;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
    border-bottom: none;
    margin-bottom: 2px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
    overflow: hidden;
    font-size: 0.8em;
    line-height: 1.4em;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
    font-size: 1rem;
    margin-block-start: 0;
    margin-block-end: 5px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
    display: inline-block;
    overflow: hidden;
    height: 2.8em;
    width: 80%;
    margin-right: 4%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
    display: inline-block;
    width: 15%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
    height: 3em;
    width: auto;
    display: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
    display: initial;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
    background-color: #eee;
  }
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
    font-weight: bold;
    font-style: normal;
  }

  </style>


  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
    font-size: 100%;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  hr.section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    margin: 0px;
  }


  d-byline {
    border-top: none;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
    border-top: none;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  /* tweak for Pandoc numbered line within distill */
  d-article pre.numberSource code > span {
      left: -2em;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // separator
    var separator = '<hr class="section-separator" style="clear: both"/>';
    // prepend separator above appendix
    $('.d-byline').before(separator);
    $('.d-article').before(separator);

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme, except when numbering line
    // in code chunk
    $('pre:not(.numberLines) code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        var author_name = front_matter.authors[i].author
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        const citeChild = $(this).children()[0]
        // Do not process if @xyz has been used without escaping and without bibliography activated
        // https://github.com/rstudio/distill/issues/466
        if (citeChild === undefined) return true

        if (citeChild.nodeName == "D-FOOTNOTE") {
          var fn = citeChild
          $(this).html(fn.shadowRoot.querySelector("sup"))
          $(this).id = fn.id
          fn.remove()
        }
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          // Could use CSS.escape too here, we insure backward compatibility in navigator
          return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // fix footnotes in tables (#411)
      // replacing broken distill.pub feature
      $('table d-footnote').each(function() {
        // we replace internal showAtNode methode which is triggered when hovering a footnote
        this.hoverBox.showAtNode = function(node) {
          // ported from https://github.com/distillpub/template/pull/105/files
          calcOffset = function(elem) {
              let x = elem.offsetLeft;
              let y = elem.offsetTop;
              // Traverse upwards until an `absolute` element is found or `elem`
              // becomes null.
              while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                  x += elem.offsetLeft;
                  y += elem.offsetTop;
              }

              return { left: x, top: y };
          }
          // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
          const bbox = node.getBoundingClientRect();
          const offset = calcOffset(node);
          this.show([offset.left + bbox.width, offset.top + bbox.height]);
        }
      })

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      // ignore leaflet img layers (#106)
      figures = figures.filter(':not(img[class*="leaflet"])')
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <style type="text/css">
  /* base variables */

  /* Edit the CSS properties in this file to create a custom
     Distill theme. Only edit values in the right column
     for each row; values shown are the CSS defaults.
     To return any property to the default,
     you may set its value to: unset
     All rows must end with a semi-colon.                      */

  /* Optional: embed custom fonts here with `@import`          */
  /* This must remain at the top of this file.                 */



  html {
    /*-- Main font sizes --*/
    --title-size:      50px;
    --body-size:       1.06rem;
    --code-size:       14px;
    --aside-size:      12px;
    --fig-cap-size:    13px;
    /*-- Main font colors --*/
    --title-color:     #000000;
    --header-color:    rgba(0, 0, 0, 0.8);
    --body-color:      rgba(0, 0, 0, 0.8);
    --aside-color:     rgba(0, 0, 0, 0.6);
    --fig-cap-color:   rgba(0, 0, 0, 0.6);
    /*-- Specify custom fonts ~~~ must be imported above   --*/
    --heading-font:    sans-serif;
    --mono-font:       monospace;
    --body-font:       sans-serif;
    --navbar-font:     sans-serif;  /* websites + blogs only */
  }

  /*-- ARTICLE METADATA --*/
  d-byline {
    --heading-size:    0.6rem;
    --heading-color:   rgba(0, 0, 0, 0.5);
    --body-size:       0.8rem;
    --body-color:      rgba(0, 0, 0, 0.8);
  }

  /*-- ARTICLE TABLE OF CONTENTS --*/
  .d-contents {
    --heading-size:    18px;
    --contents-size:   13px;
  }

  /*-- ARTICLE APPENDIX --*/
  d-appendix {
    --heading-size:    15px;
    --heading-color:   rgba(0, 0, 0, 0.65);
    --text-size:       0.8em;
    --text-color:      rgba(0, 0, 0, 0.5);
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  /* These properties only apply to Distill sites and blogs  */

  .distill-site-header {
    --title-size:       18px;
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #0F2E3D;
  }

  .distill-site-footer {
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #0F2E3D;
  }

  /*-- Additional custom styles --*/
  /* Add any additional CSS rules below                      */
  </style>
  <style type="text/css">@import url('https://fonts.googleapis.com/css2?family=Open+Sans&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Amaranth&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Kalam&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Sriracha&display=swap');
  /* base variables */

  /* Edit the CSS properties in this file to create a custom
     Distill theme. Only edit values in the right column
     for each row; values shown are the CSS defaults.
     To return any property to the default,
     you may set its value to: unset
     All rows must end with a semi-colon.                      */

  /* Optional: embed custom fonts here with `@import`          */
  /* This must remain at the top of this file.                 */



  html {
    /*-- Main font sizes --*/
    --title-size:      40px;
    --body-size:       18px;
    --code-size:       16px;
    --aside-size:      12px;
    --fig-cap-size:    13px;
    /*-- Main font colors --*/
    --title-color:     #01161E;
    --header-color:    #01161E;
    --body-color:      #01161E;
    --aside-color:     #01161E;
    --fig-cap-color:   #01161E;
    /*-- Specify custom fonts ~~~ must be imported above   --*/
    --heading-font:    Amaranth;
    --mono-font:       monospace;
    --body-font:       "Open Sans";
    --navbar-font:     Amaranth;  /* websites + blogs only */
  }

  /*-- ARTICLE METADATA --*/
  d-byline {
    --heading-size:    0.6rem;
    --heading-color:   rgba(0, 0, 0, 0.5);
    --body-size:       0.8rem;
    --body-color:      rgba(0, 0, 0, 0.8);
  }

  /*-- ARTICLE TABLE OF CONTENTS --*/
  .d-contents {
    --heading-size:    18px;
    --contents-size:   13px;
  }

  /*-- ARTICLE APPENDIX --*/
  d-appendix {
    --heading-size:    15px;
    --heading-color:   rgba(0, 0, 0, 0.65);
    --text-size:       0.8em;
    --text-color:      rgba(0, 0, 0, 0.5);
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  /* These properties only apply to Distill sites and blogs  */

  .distill-site-header {
    --title-size:       20px;
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        20px;
    --hover-color:      white;
    --bkgd-color:       #C34A79;
  }
  .dropdown
  .distill-site-footer {
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #01161E;
  }

  /*-- Additional custom styles --*/
  /* Add any additional CSS rules below                      */


  h1 {
    color: #C34A79;
    font-size: 36px;
  }

  h2 {
    color: #C34A79;
    font-size: 32px;
  }

  h3 {
    color: #C34A79;
    font-size: 28px;
  }

  d-article h1 {
    color: #C34A79 !important;
    font-size: 38px;
    line-height: 1em;
  }


  d-article h2 {
    color: #C34A79 !important;
    font-size: 34px;
  }

  d-article h3 {
    color: #C34A79!important;
    font-size: 30px;
  }

  /*change url color */
  a {
    color: #C34A79;
  }

  a:hover {
    color: #007bff;
  }


  /*change body color*/

  body {
    color: #01161E;
    font-size: 18px;
  }

  p {
    color: #01161E;
  }

  .license {
    color: #01161E;
    font-size: 14px !important;
    margin-left: 50px;
    margin-right: 60px;
  }

  /*single space for the lists*/
  d-article li {
      margin-bottom: 0em;
  }

  /*change buttons on homepage*/
  .btn-outline-dark {
      background-color: transparent; 
      color: rgba(195, 74, 121);
      border: 1px solid;
      border-color: rgba(195, 74, 121);
  }

  .btn-outline-dark:hover {
      background-color: rgba(195, 74, 121);
      border-color: rgba(195, 74, 121);
      color: white;
  }


  /*make logo larger*/
  .rounded {
    height: 15rem !important; 
  }

  /*remove search function*/
  .nav-search {
    display: none !important;
  }

  .algolia-autocomplete {
    display: none !important;
  }

  .nav-left {
    padding: 0.35em;
  }

  .nav-right {
    padding: 0.35em;
  }

  .timeline-Widget{
    width: 40%;
    min-width: 200px;
    max-width: 500px;
  }

  /*
  .green-oak{
    width: 10% !important;
    min-width: 120px;
    max-width: 200px;
  }
  */

  .contributor_org {
    font-family: "Amaranth" !important;
    font-size: 25px;
    text-decoration: none;
    background-color: transparent;
  }

  .contributor_ppl{
    font-family: "Open Sans" !important;
    font-size: 20px;
  }

  /* Change link appearance on contributor page */ 
  d-article a {
    color: #C34A79;
    border-bottom: none;
  }


  /*
  .p2{
    font-family: "Open Sans" !important;
    font-size: 20px;
    color: #01161E;
  }
  */

  .left {
    float: left;
  }

  /*do not delete - this removes the scroll bar on the right hand side*/
  .vh-100 {
    height: 80vh!important;
  }
  </style>
  <style type="text/css">
  /* base style */

  /* FONT FAMILIES */

  :root {
    --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  body,
  .posts-list .post-preview p,
  .posts-list .description p {
    font-family: var(--body-font), var(--body-default);
  }

  h1, h2, h3, h4, h5, h6,
  .posts-list .post-preview h2,
  .posts-list .description h2 {
    font-family: var(--heading-font), var(--heading-default);
  }

  d-article div.sourceCode code,
  d-article pre code {
    font-family: var(--mono-font), var(--mono-default);
  }


  /*-- TITLE --*/
  d-title h1,
  .posts-list > h1 {
    color: var(--title-color, black);
  }

  d-title h1 {
    font-size: var(--title-size, 50px);
  }

  /*-- HEADERS --*/
  d-article h1,
  d-article h2,
  d-article h3,
  d-article h4,
  d-article h5,
  d-article h6 {
    color: var(--header-color, rgba(0, 0, 0, 0.8));
  }

  /*-- BODY --*/
  d-article > p,  /* only text inside of <p> tags */
  d-article > ul, /* lists */
  d-article > ol {
    color: var(--body-color, rgba(0, 0, 0, 0.8));
    font-size: var(--body-size, 1.06rem);
  }


  /*-- CODE --*/
  d-article div.sourceCode code,
  d-article pre code {
    font-size: var(--code-size, 14px);
  }

  /*-- ASIDE --*/
  d-article aside {
    font-size: var(--aside-size, 12px);
    color: var(--aside-color, rgba(0, 0, 0, 0.6));
  }

  /*-- FIGURE CAPTIONS --*/
  figure .caption,
  figure figcaption,
  .figure .caption {
    font-size: var(--fig-cap-size, 13px);
    color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
  }

  /*-- METADATA --*/
  d-byline h3 {
    font-size: var(--heading-size, 0.6rem);
    color: var(--heading-color, rgba(0, 0, 0, 0.5));
  }

  d-byline {
    font-size: var(--body-size, 0.8rem);
    color: var(--body-color, rgba(0, 0, 0, 0.8));
  }

  d-byline a,
  d-article d-byline a {
    color: var(--body-color, rgba(0, 0, 0, 0.8));
  }

  /*-- TABLE OF CONTENTS --*/
  .d-contents nav h3 {
    font-size: var(--heading-size, 18px);
  }

  .d-contents nav a {
    font-size: var(--contents-size, 13px);
  }

  /*-- APPENDIX --*/
  d-appendix h3 {
    font-size: var(--heading-size, 15px);
    color: var(--heading-color, rgba(0, 0, 0, 0.65));
  }

  d-appendix {
    font-size: var(--text-size, 0.8em);
    color: var(--text-color, rgba(0, 0, 0, 0.5));
  }

  d-appendix d-footnote-list a.footnote-backlink {
    color: var(--text-color, rgba(0, 0, 0, 0.5));
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  .distill-site-header .title {
    font-size: var(--title-size, 18px);
    font-family: var(--navbar-font), var(--heading-default);
  }

  .distill-site-header a,
  .nav-dropdown .nav-dropbtn {
    font-family: var(--navbar-font), var(--heading-default);
  }

  .nav-dropdown .nav-dropbtn {
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    font-size: var(--text-size, 15px);
  }

  .distill-site-header a:hover,
  .nav-dropdown:hover .nav-dropbtn {
    color: var(--hover-color, white);
  }

  .distill-site-header {
    font-size: var(--text-size, 15px);
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    background-color: var(--bkgd-color, #0F2E3D);
  }

  .distill-site-footer {
    font-size: var(--text-size, 15px);
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    background-color: var(--bkgd-color, #0F2E3D);
  }

  .distill-site-footer a:hover {
    color: var(--hover-color, white);
  }</style>
  <!--/radix_placeholder_distill-->
  <script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
  <script src="site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"A robust method to estimate future frost risks","authors":[]}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="index.html" class="title">Jacqueline Wingen</a>
</div>
<div class="nav-right">
<a href="index.html">Home</a>
<a href="getting_started.html">Goals &amp; Tools</a>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Introduction
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="tree_dormancy.html">Tree Dormancy</a>
<a href="climate_change.html">Climate change and impact projection</a>
<a href="winter_chill.html">Winter chill projections</a>
<a href="manual_chill.html">Manual chill analysis</a>
<a href="chill.html">Chill models</a>
</div>
</div>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Temperature
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="making_temp.html">Making hourly temperatures</a>
<a href="tools.html">Useful tools in R</a>
<a href="temp_data.html">Getting temperature data</a>
<a href="gaps.html">Filling gaps in temperature records</a>
<a href="generate_temp.html">Generating temperature scenarios</a>
<a href="save.html">Saving and loading data</a>
<a href="historic.html">Historic temperature scenarios</a>
<a href="future.html">Future temperature scenarios</a>
<a href="cmip6.html">Making CMIP6 scenarios</a>
<a href="cmip5.html">Making CMIP5 scenarios with the ClimateWizard</a>
<a href="plot.html">Plotting future scenarios</a>
<a href="chill_model.html">Chill model comparison</a>
</div>
</div>
<div class="nav-dropdown">
<button class="nav-dropbtn">
PLS
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="simple_phenology.html">Simple phenology analysis</a>
<a href="PLS_regression.html">Delineating temperature response phases with PLS regression</a>
<a href="successes_and_limitations.html">Successes and limitations of PLS regression analysis</a>
<a href="agroclimatic.html">PLS regression with agroclimatic metrics</a>
<a href="examples.html">Examples of PLS regression with agroclimatic metrics</a>
<a href="PLS_not_work.html">Why PLS doesn’t always work</a>
<a href="outputs.html">Evaluating PLS outputs</a>
<a href="chill_heat.html">The relative importance of chill and heat</a>
<a href="enhanced_PLS.html">Experimentally enhanced PLS</a>
<a href="valid_models.html">Making valid tree phenology models</a>
</div>
</div>
<div class="nav-dropdown">
<button class="nav-dropbtn">
PhenoFlex
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="phenoflex1.html">The PhenoFlex model</a>
<a href="phenoflex2.html">The PhenoFlex model - a second look</a>
<a href="improve.html">Can we improve the performance of PhenoFlex?</a>
<a href="frost_risk.html">Frost risk analysis</a>
<a href="estimate.html">A robust method to estimate future frost risk</a>
<a href="major_concepts.html">Major concepts</a>
</div>
</div>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>A robust method to estimate future frost risks</h1>

<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->

</div>


<div class="d-article">
<h2 id="frost-risk-in-future-scenarios">Frost Risk in Future Scenarios</h2>
<p>Assessing spring frost risk in temperate fruit trees is crucial but insufficient for planning future adaptation. A comprehensive approach must estimate both the probability and severity of future frost events under climate change.</p>
<p>Spring frost risk depends on temperature thresholds affecting plant tissues and the temperature-driven progression of tree phenology. Sensitivity increases as trees develop, with timing varying by species, cultivar, and location. Reliable analysis requires robust temperature projections and accurate bloom date modeling. Advances like future temperature scenarios and the PhenoFlex model enhance predictions.</p>
<p>Historical data from Campus Klein-Altendorf is combined with simulated conditions to assess relevance for future climates. The following plot illustrates this approach:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Import the past weather dataset to build the hull plots for model validity domains</span></span>
<span><span class='co'># Note: data from 01.01.1958 to 20.06.2019. Not complete season for bloom in 1958 (missing Oct-Dec 1957). Barely passing the threshold for bloom in 2019 (need to set mrange to c(9, 5) in genSeasonList for PhenoFlex calibration)</span></span>
<span><span class='va'>past_weather</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/chillR/man/read_tab.html'>read_tab</a></span><span class='op'>(</span><span class='st'>"data/TMaxTMin1958-2019_patched.csv"</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Add the column SSP_Time for further discrimination with future scenarios</span></span>
<span><span class='va'>past_weather</span><span class='op'>$</span><span class='va'>SSP_Time</span> <span class='op'>&lt;-</span> <span class='st'>"Past"</span></span>
<span></span>
<span><span class='co'># Summarize the data by month. Compute the mean of Tmin and Tmax by RCP_Time, Year, and Month</span></span>
<span><span class='va'>past_months</span> <span class='op'>&lt;-</span> <span class='va'>past_weather</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>SSP_Time</span>, <span class='va'>Year</span>, <span class='va'>Month</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarize</a></span><span class='op'>(</span>Tmin <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>Tmin</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span>            Tmax <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>Tmax</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='va'>unstructured_future_temps</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/chillR/man/load_temperature_scenarios.html'>load_temperature_scenarios</a></span><span class='op'>(</span><span class='st'>"data/future_climate"</span>,</span>
<span>                                                        <span class='st'>"Bonn_futuretemps"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>future_temps</span> <span class='op'>&lt;-</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind_rows.html'>bind_rows</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>unstructured_future_temps</span>, <span class='va'>bind_rows</span><span class='op'>)</span>,</span>
<span>                       .id <span class='op'>=</span> <span class='st'>"List"</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>future_temps</span> <span class='op'>&lt;-</span> <span class='va'>future_temps</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>GCM <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/strsplit.html'>strsplit</a></span><span class='op'>(</span><span class='va'>List</span>, <span class='st'>'\\.'</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>           <span class='fu'><a href='https://purrr.tidyverse.org/reference/map.html'>map</a></span><span class='op'>(</span><span class='fl'>3</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>           <span class='fu'><a href='https://rdrr.io/r/base/unlist.html'>unlist</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>         SSP <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/strsplit.html'>strsplit</a></span><span class='op'>(</span><span class='va'>List</span>, <span class='st'>'\\.'</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>           <span class='fu'><a href='https://purrr.tidyverse.org/reference/map.html'>map</a></span><span class='op'>(</span><span class='fl'>2</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>           <span class='fu'><a href='https://rdrr.io/r/base/unlist.html'>unlist</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>         Time <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/strsplit.html'>strsplit</a></span><span class='op'>(</span><span class='va'>List</span>, <span class='st'>'\\.'</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>           <span class='fu'><a href='https://purrr.tidyverse.org/reference/map.html'>map</a></span><span class='op'>(</span><span class='fl'>4</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>           <span class='fu'><a href='https://rdrr.io/r/base/unlist.html'>unlist</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>DATE</span>, <span class='va'>Year</span>, <span class='va'>Month</span>, <span class='va'>Day</span>, <span class='va'>Tmin</span>, <span class='va'>Tmax</span>, <span class='va'>SSP</span>, <span class='va'>Time</span>, <span class='va'>GCM</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>future_temps</span><span class='op'>[</span><span class='va'>future_temps</span><span class='op'>$</span><span class='va'>SSP</span> <span class='op'>==</span> <span class='st'>"ssp126"</span>,<span class='st'>"SSP_Time"</span><span class='op'>]</span> <span class='op'>&lt;-</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='st'>"SSP1"</span>, <span class='va'>future_temps</span><span class='op'>[</span><span class='va'>future_temps</span><span class='op'>$</span><span class='va'>SSP</span> <span class='op'>==</span> <span class='st'>"ssp126"</span>,<span class='st'>"Time"</span><span class='op'>]</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>future_temps</span><span class='op'>[</span><span class='va'>future_temps</span><span class='op'>$</span><span class='va'>SSP</span> <span class='op'>==</span> <span class='st'>"ssp245"</span>,<span class='st'>"SSP_Time"</span><span class='op'>]</span> <span class='op'>&lt;-</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='st'>"SSP2"</span>, <span class='va'>future_temps</span><span class='op'>[</span><span class='va'>future_temps</span><span class='op'>$</span><span class='va'>SSP</span> <span class='op'>==</span> <span class='st'>"ssp245"</span>,<span class='st'>"Time"</span><span class='op'>]</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>future_temps</span><span class='op'>[</span><span class='va'>future_temps</span><span class='op'>$</span><span class='va'>SSP</span> <span class='op'>==</span> <span class='st'>"ssp370"</span>,<span class='st'>"SSP_Time"</span><span class='op'>]</span> <span class='op'>&lt;-</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='st'>"SSP3"</span>, <span class='va'>future_temps</span><span class='op'>[</span><span class='va'>future_temps</span><span class='op'>$</span><span class='va'>SSP</span> <span class='op'>==</span> <span class='st'>"ssp370"</span>,<span class='st'>"Time"</span><span class='op'>]</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>future_temps</span><span class='op'>[</span><span class='va'>future_temps</span><span class='op'>$</span><span class='va'>SSP</span> <span class='op'>==</span> <span class='st'>"ssp585"</span>,<span class='st'>"SSP_Time"</span><span class='op'>]</span> <span class='op'>&lt;-</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='st'>"SSP5"</span>, <span class='va'>future_temps</span><span class='op'>[</span><span class='va'>future_temps</span><span class='op'>$</span><span class='va'>SSP</span> <span class='op'>==</span> <span class='st'>"ssp585"</span>,<span class='st'>"Time"</span><span class='op'>]</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='co'># Summarize the data by month. Compute the mean of Tmin and Tmax by RCP_Time, Year, and Month</span></span>
<span><span class='va'>future_months</span> <span class='op'>&lt;-</span> <span class='va'>future_temps</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>SSP_Time</span>, <span class='va'>Year</span>, <span class='va'>Month</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarize</a></span><span class='op'>(</span>Tmin <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>Tmin</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span>            Tmax <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>Tmax</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  </span>
<span></span>
<span><span class='co'># Merge the past and future months to plot them together</span></span>
<span><span class='va'>all_months</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://www.math.uzh.ch/pages/spam/reference/cbind.html'>rbind</a></span><span class='op'>(</span><span class='va'>past_months</span>,</span>
<span>                    <span class='va'>future_months</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Add a column for the name of the month </span></span>
<span><span class='va'>all_months</span><span class='op'>$</span><span class='va'>month_name</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>all_months</span><span class='op'>$</span><span class='va'>Month</span>,</span>
<span>                                levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>6</span> <span class='op'>:</span> <span class='fl'>12</span>, <span class='fl'>1</span> <span class='op'>:</span> <span class='fl'>5</span><span class='op'>)</span>, </span>
<span>                                labels <span class='op'>=</span> <span class='va'>month.name</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>6</span> <span class='op'>:</span> <span class='fl'>12</span>, <span class='fl'>1</span> <span class='op'>:</span> <span class='fl'>5</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Calculate the hulls for each group</span></span>
<span><span class='va'>hull_temps</span> <span class='op'>&lt;-</span> <span class='va'>all_months</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>SSP_Time</span>, <span class='va'>month_name</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grDevices/chull.html'>chull</a></span><span class='op'>(</span><span class='va'>Tmin</span>, <span class='va'>Tmax</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Load the weather data from the experimental seasons to generate an "Enhanced" temps category</span></span>
<span><span class='va'>enhanced</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/chillR/man/read_tab.html'>read_tab</a></span><span class='op'>(</span><span class='st'>"data/final_weather_data_S1_S2_pear_hourly.csv"</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Summarize the data. Compute the minimum and maximum records in a daily basis</span></span>
<span><span class='va'>enhanced</span> <span class='op'>&lt;-</span> <span class='va'>enhanced</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>YEARMODA</span>, <span class='va'>Treatment</span>, <span class='va'>Year</span>, <span class='va'>Month</span> <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarize</a></span><span class='op'>(</span>Tmin <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>Temp</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span>            Tmax <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>Temp</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Summarize the data by month now. Compute mean across minimum and maximum records</span></span>
<span><span class='va'>enhanced</span> <span class='op'>&lt;-</span> <span class='va'>enhanced</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>Treatment</span>, <span class='va'>Month</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarize</a></span><span class='op'>(</span>Tmin <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>Tmin</span><span class='op'>)</span>,</span>
<span>                                                                  Tmax <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>Tmax</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Re-format the column Year and add the column RCP_Time</span></span>
<span><span class='va'>enhanced</span><span class='op'>$</span><span class='va'>Year</span> <span class='op'>&lt;-</span> <span class='va'>enhanced</span><span class='op'>$</span><span class='va'>Treatment</span></span>
<span><span class='va'>enhanced</span><span class='op'>$</span><span class='va'>SSP_Time</span> <span class='op'>&lt;-</span> <span class='st'>"Past_enhanced"</span></span>
<span></span>
<span><span class='co'># Combining the past and the enhanced temps</span></span>
<span><span class='va'>past_months</span><span class='op'>$</span><span class='va'>SSP_Time</span> <span class='op'>&lt;-</span> <span class='st'>"Past combined"</span></span>
<span><span class='va'>enhanced</span><span class='op'>$</span><span class='va'>SSP_Time</span> <span class='op'>&lt;-</span> <span class='st'>"Past combined"</span></span>
<span></span>
<span><span class='co'># Merge all the data. Simulated scenarios, observed scenarios, and enhanced temps</span></span>
<span><span class='va'>all_months_both</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://www.math.uzh.ch/pages/spam/reference/cbind.html'>rbind</a></span><span class='op'>(</span><span class='va'>enhanced</span>, <span class='va'>past_months</span>, <span class='va'>future_months</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Add the labels for the month no</span></span>
<span><span class='va'>all_months_both</span><span class='op'>$</span><span class='va'>month_name</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>all_months_both</span><span class='op'>$</span><span class='va'>Month</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>6</span> <span class='op'>:</span> <span class='fl'>12</span>, <span class='fl'>1</span> <span class='op'>:</span> <span class='fl'>5</span><span class='op'>)</span>, labels <span class='op'>=</span> <span class='va'>month.name</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>6</span> <span class='op'>:</span> <span class='fl'>12</span>, <span class='fl'>1</span> <span class='op'>:</span> <span class='fl'>5</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Create the hull</span></span>
<span><span class='va'>hull_temps_both</span> <span class='op'>&lt;-</span> <span class='va'>all_months_both</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>SSP_Time</span>, <span class='va'>month_name</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grDevices/chull.html'>chull</a></span><span class='op'>(</span><span class='va'>Tmin</span>, <span class='va'>Tmax</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Remove the temperature for the treatments excluded from the analysis. These treatments may be a bit unrealistic and therefore</span></span>
<span><span class='co'># difficult to be explained by the model</span></span>
<span><span class='va'>all_months_both_conference</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>all_months_both</span>, <span class='op'>!</span><span class='op'>(</span><span class='va'>Year</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='fl'>8</span>, <span class='fl'>9</span>, <span class='fl'>12</span>, <span class='fl'>13</span>, <span class='fl'>14</span>, <span class='fl'>15</span>, <span class='fl'>19</span>,</span>
<span>                                                                    <span class='fl'>23</span>, <span class='fl'>25</span>, <span class='fl'>26</span>, <span class='fl'>27</span>, <span class='fl'>28</span>, <span class='fl'>29</span>, <span class='fl'>32</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='co'># Create the hull again</span></span>
<span><span class='va'>hull_temps_both_conference</span> <span class='op'>&lt;-</span> <span class='va'>all_months_both_conference</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>SSP_Time</span>,<span class='va'>month_name</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grDevices/chull.html'>chull</a></span><span class='op'>(</span><span class='va'>Tmin</span>, <span class='va'>Tmax</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.csv</a></span><span class='op'>(</span><span class='va'>hull_temps_both</span>,<span class='st'>"data/hull_temps_both.csv"</span>,row.names <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.csv</a></span><span class='op'>(</span><span class='va'>hull_temps_both_conference</span>, <span class='st'>"data/hull_temps_both_conference.csv"</span>,row.names <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>hull_temps_both</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/chillR/man/read_tab.html'>read_tab</a></span><span class='op'>(</span><span class='st'>"data/hull_temps_both.csv"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>hull_temps_both</span><span class='op'>$</span><span class='va'>month_name</span> <span class='op'>&lt;-</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>hull_temps_both</span><span class='op'>$</span><span class='va'>Month</span>,</span>
<span>         levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>6</span><span class='op'>:</span><span class='fl'>12</span>, <span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span><span class='op'>)</span>,</span>
<span>         labels <span class='op'>=</span> <span class='va'>month.name</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>6</span><span class='op'>:</span><span class='fl'>12</span>, <span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Implement the plot showing the overlap among conditions</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>hull_temps_both</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>hull_temps_both</span><span class='op'>$</span><span class='va'>Month</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>10</span>,<span class='fl'>11</span>,<span class='fl'>12</span>,<span class='fl'>1</span>,<span class='fl'>2</span>,<span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>,<span class='op'>]</span>,</span>
<span>       <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>Tmin</span>, <span class='va'>Tmax</span>, fill <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>SSP_Time</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_polygon.html'>geom_polygon</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>month_name</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>name<span class='op'>=</span><span class='st'>"Scenario"</span>,</span>
<span>                    breaks<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Past combined"</span>,</span>
<span>                             <span class='st'>"SSP1 2050"</span>,</span>
<span>                             <span class='st'>"SSP1 2085"</span>,</span>
<span>                             <span class='st'>"SSP2 2050"</span>,</span>
<span>                             <span class='st'>"SSP2 2085"</span>,</span>
<span>                             <span class='st'>"SSP3 2050"</span>,</span>
<span>                             <span class='st'>"SSP3 2085"</span>,</span>
<span>                             <span class='st'>"SSP5 2050"</span>,</span>
<span>                             <span class='st'>"SSP5 2085"</span><span class='op'>)</span>,</span>
<span>                    values<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"black"</span>,</span>
<span>                             <span class='fu'><a href='https://scales.r-lib.org/reference/alpha.html'>alpha</a></span><span class='op'>(</span><span class='st'>"light green"</span>,<span class='fl'>0.4</span><span class='op'>)</span>,</span>
<span>                             <span class='fu'><a href='https://scales.r-lib.org/reference/alpha.html'>alpha</a></span><span class='op'>(</span><span class='st'>"dark green"</span>,<span class='fl'>0.4</span><span class='op'>)</span>,</span>
<span>                             <span class='fu'><a href='https://scales.r-lib.org/reference/alpha.html'>alpha</a></span><span class='op'>(</span><span class='st'>"coral"</span>,<span class='fl'>0.4</span><span class='op'>)</span>,</span>
<span>                             <span class='fu'><a href='https://scales.r-lib.org/reference/alpha.html'>alpha</a></span><span class='op'>(</span><span class='st'>"dark red"</span>,<span class='fl'>0.4</span><span class='op'>)</span>,</span>
<span>                             <span class='fu'><a href='https://scales.r-lib.org/reference/alpha.html'>alpha</a></span><span class='op'>(</span><span class='st'>"yellow"</span>,<span class='fl'>0.4</span><span class='op'>)</span>,</span>
<span>                             <span class='fu'><a href='https://scales.r-lib.org/reference/alpha.html'>alpha</a></span><span class='op'>(</span><span class='st'>"orange"</span>,<span class='fl'>0.4</span><span class='op'>)</span>,                 </span>
<span>                             <span class='fu'><a href='https://scales.r-lib.org/reference/alpha.html'>alpha</a></span><span class='op'>(</span><span class='st'>"light blue"</span>,<span class='fl'>0.4</span><span class='op'>)</span>,</span>
<span>                             <span class='fu'><a href='https://scales.r-lib.org/reference/alpha.html'>alpha</a></span><span class='op'>(</span><span class='st'>"dark blue"</span>,<span class='fl'>0.4</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>xlab</a></span><span class='op'>(</span><span class='st'>"Mean daily minimum temperature (°C)"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ylab</a></span><span class='op'>(</span><span class='st'>"Mean daily maximum temperature (°C)"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span>base_size <span class='op'>=</span> <span class='fl'>15</span><span class='op'>)</span></span></code></pre>
</div>
<p><img src="estimate_files/figure-html5/unnamed-chunk-3-1.png" width="624" /></p>
</div>
<p>This convex-hull plot shows the temperature coverage at CKA from 1958 to 2019, alongside all experimental seasons analyzed in the Experimentally Enhanced PLS chapter.</p>
<p>To integrate historical and experimental data into phenology modeling, records from the same species and cultivar (pear cultivar ‘Conference’) are required. Historical full bloom records for this cultivar exist from 1958 to 2019. However, to avoid distortions from extreme warming treatments, the experimental data used in the convex-hull plot may need refinement by excluding unusually warm seasons.</p>
<p>The following plot presents an updated version without these extreme conditions:</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="estimate_files/figure-html5/unnamed-chunk-4-1.png" width="624" /></p>
</div>
<p>The coverage remains incomplete, as data for October and November is missing. Filling this gap is challenging since warmer conditions were not included in the experiments during these months.</p>
<p>The analysis will continue with the available data, anticipating that future identification of ‘normal seasons’ in the experimental dataset will improve the modeling domain’s validity.</p>
<p>Next, the <code>PhenoFlex</code> dormancy modeling framework will be implemented by integrating historical and experimental records. The following code chunk imports and formats the data for model calibration.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Import the phenology data for the historical period 1958-2019</span></span>
<span><span class='co'># Note that we are selecting only the Year and full bloom columns</span></span>
<span><span class='va'>historic_pheno_conference</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/chillR/man/read_tab.html'>read_tab</a></span><span class='op'>(</span><span class='st'>"data/Pheno_pear_conference_1958_2019.csv"</span><span class='op'>)</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Year"</span>,</span>
<span>                                         <span class='st'>"Full_bloom"</span><span class='op'>)</span><span class='op'>]</span></span>
<span></span>
<span><span class='co'># Remove missing years</span></span>
<span><span class='va'>historic_pheno_conference</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>historic_pheno_conference</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>historic_pheno_conference</span><span class='op'>$</span><span class='va'>Full_bloom</span><span class='op'>==</span><span class='st'>""</span><span class='op'>)</span>,<span class='op'>]</span></span>
<span></span>
<span><span class='co'># Add a column for the JDay</span></span>
<span><span class='va'>historic_pheno_conference</span><span class='op'>$</span><span class='va'>Full_bloom</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='fu'>dormancyR</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/dormancyR/man/date_to_JDay.html'>date_to_JDay</a></span><span class='op'>(</span>date <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='va'>historic_pheno_conference</span><span class='op'>$</span><span class='va'>Full_bloom</span>,</span>
<span>                                         format <span class='op'>=</span> <span class='st'>"%d.%m.%Y"</span><span class='op'>)</span>,</span>
<span>                          format <span class='op'>=</span> <span class='st'>"%Y-%m-%d"</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Rename the columns</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>historic_pheno_conference</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Year"</span>, <span class='st'>"pheno"</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Do the same for the weather data</span></span>
<span><span class='va'>past_weather</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/chillR/man/read_tab.html'>read_tab</a></span><span class='op'>(</span><span class='st'>"data/TMaxTMin1958-2019_patched.csv"</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Create hourly temps for compatibility with the experimental data set</span></span>
<span><span class='va'>past_weather</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/chillR/man/stack_hourly_temps.html'>stack_hourly_temps</a></span><span class='op'>(</span>weather <span class='op'>=</span> <span class='va'>past_weather</span>, </span>
<span>                                   latitude <span class='op'>=</span> <span class='fl'>50.4</span><span class='op'>)</span><span class='op'>[[</span><span class='st'>"hourtemps"</span><span class='op'>]</span><span class='op'>]</span></span>
<span></span>
<span></span>
<span><span class='co'># Load the experimental data</span></span>
<span><span class='co'># Load the data from the folder</span></span>
<span><span class='va'>exp_weather</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/chillR/man/read_tab.html'>read_tab</a></span><span class='op'>(</span><span class='st'>"data/final_weather_data_S1_S2_pear_hourly.csv"</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Generate a new column (Year_2) to simulate the year and comply with the format of PhenoFlex functions</span></span>
<span><span class='va'>exp_weather</span><span class='op'>[</span><span class='st'>"Year_2"</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>exp_weather</span><span class='op'>$</span><span class='va'>Treatment</span> <span class='op'>+</span> <span class='va'>exp_weather</span><span class='op'>$</span><span class='va'>Year</span> <span class='op'>+</span> <span class='fl'>3</span></span>
<span></span>
<span><span class='co'># Since this experiment was conducted during two consecutive seasons, the next step will fix a small continuity issue</span></span>
<span><span class='co'># generated during the season 2</span></span>
<span><span class='va'>exp_weather</span><span class='op'>[</span><span class='va'>exp_weather</span><span class='op'>$</span><span class='va'>Treatment</span> <span class='op'>&gt;=</span> <span class='fl'>17</span>, <span class='st'>"Year_2"</span><span class='op'>]</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>exp_weather</span><span class='op'>[</span><span class='va'>exp_weather</span><span class='op'>$</span><span class='va'>Treatment</span> <span class='op'>&gt;=</span> <span class='fl'>17</span>, <span class='st'>"Year_2"</span><span class='op'>]</span> <span class='op'>-</span> <span class='fl'>1</span></span>
<span></span>
<span><span class='co'># For further compatibility, I will now select the columns needed and will drop "Year" (the original one)</span></span>
<span><span class='va'>exp_weather</span> <span class='op'>&lt;-</span> <span class='va'>exp_weather</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"YEARMODA"</span>,</span>
<span>                             <span class='st'>"Year_2"</span>, </span>
<span>                             <span class='st'>"Month"</span>, </span>
<span>                             <span class='st'>"Day"</span>,</span>
<span>                             <span class='st'>"Hour"</span>, </span>
<span>                             <span class='st'>"JDay"</span>, </span>
<span>                             <span class='st'>"Temp"</span><span class='op'>)</span><span class='op'>]</span></span>
<span></span>
<span><span class='co'># To replace the missing "Year" column, I will now change the name of the column</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>exp_weather</span><span class='op'>)</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>exp_weather</span><span class='op'>)</span> <span class='op'>==</span> <span class='st'>"Year_2"</span><span class='op'>)</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='st'>"Year"</span></span>
<span></span>
<span></span>
<span><span class='co'># Import the phenology data from the repository</span></span>
<span><span class='va'>exp_pheno</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/chillR/man/read_tab.html'>read_tab</a></span><span class='op'>(</span><span class='st'>"data/final_bio_data_S1_S2_pear.csv"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>exp_pheno</span><span class='op'>[</span><span class='st'>"Treatment"</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>exp_pheno</span><span class='op'>$</span><span class='va'>Treatment</span> <span class='op'>+</span> <span class='fl'>2019</span> <span class='op'>+</span> <span class='fl'>3</span></span>
<span></span>
<span><span class='co'># Remove conflictive treatments</span></span>
<span><span class='va'>exp_pheno</span> <span class='op'>&lt;-</span> <span class='va'>exp_pheno</span><span class='op'>[</span><span class='op'>!</span><span class='op'>(</span><span class='va'>exp_pheno</span><span class='op'>$</span><span class='va'>Treatment</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2025</span>, <span class='fl'>2030</span>, <span class='fl'>2031</span>, <span class='fl'>2034</span>, <span class='fl'>2035</span>, <span class='fl'>2036</span>, <span class='fl'>2037</span>, <span class='fl'>2041</span>,</span>
<span>                                                    <span class='fl'>2045</span>, <span class='fl'>2047</span>, <span class='fl'>2048</span>, <span class='fl'>2049</span>, <span class='fl'>2050</span>, <span class='fl'>2051</span>, <span class='fl'>2054</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>                       <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Treatment"</span>, <span class='st'>"pheno"</span><span class='op'>)</span><span class='op'>]</span></span>
<span></span>
<span><span class='co'># Rename the columns to match the names of the historical dataset</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>exp_pheno</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Year"</span>, <span class='st'>"pheno"</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='co'># Merge the historical and experimental phenology data</span></span>
<span><span class='va'>pheno_merged</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind_rows.html'>bind_rows</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>historic_pheno_conference</span>, <span class='va'>Year</span> <span class='op'>!=</span> <span class='fl'>1958</span><span class='op'>)</span>,</span>
<span>                          <span class='va'>exp_pheno</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='co'># Merge the historical and experimental phenology data</span></span>
<span><span class='va'>weather_merged</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind_rows.html'>bind_rows</a></span><span class='op'>(</span><span class='va'>past_weather</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>past_weather</span><span class='op'>)</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>exp_weather</span><span class='op'>)</span><span class='op'>]</span>,</span>
<span>                            <span class='va'>exp_weather</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The historical and experimental data for phenology and weather records are now combined into a single dataset. The same procedure used in the chapter <em>Can we improve the performance of PhenoFlex?</em> can be applied to fit the <code>PhenoFlex</code> parameters to the data.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Define the season used for calibration and validation in the PhenoFlex modelling approach</span></span>
<span><span class='va'>calibration_seasons</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sort.html'>sort</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='va'>pheno_merged</span><span class='op'>$</span><span class='va'>Year</span>, <span class='fl'>50</span>, replace <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>validation_seasons</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sort.html'>sort</a></span><span class='op'>(</span><span class='va'>pheno_merged</span><span class='op'>[</span><span class='op'>!</span><span class='op'>(</span><span class='va'>pheno_merged</span><span class='op'>$</span><span class='va'>Year</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='va'>calibration_seasons</span><span class='op'>)</span>, <span class='st'>"Year"</span><span class='op'>]</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Define the list of seasons (weather data)</span></span>
<span><span class='va'>weather_season_list</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/chillR/man/genSeasonList.html'>genSeasonList</a></span><span class='op'>(</span><span class='va'>weather_merged</span>, mrange <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>9</span>, <span class='fl'>5</span><span class='op'>)</span>, years <span class='op'>=</span> <span class='va'>calibration_seasons</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The <code>PhenoFlex</code> model fitting procedure can now be applied, following the approach outlined in <em>The PhenoFlex Model</em> chapter. Initially, wide parameter ranges—particularly for <em>yc</em> and <em>zc</em>—are used to let the model determine optimal estimates. The fitted parameters and predicted bloom dates are then saved in the <code>data</code> folder.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Set the initial parameters (wide ranges)</span></span>
<span><span class='co'>#          yc,  zc,  s1, Tu,     E0,      E1,     A0,          A1,   Tf, Tc, Tb, slope</span></span>
<span><span class='va'>lower</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>20</span>, <span class='fl'>100</span>, <span class='fl'>0.1</span>,  <span class='fl'>0</span>, <span class='fl'>3000.0</span>,  <span class='fl'>9000.0</span>, <span class='fl'>6000.0</span>,       <span class='fl'>5.e13</span>,    <span class='fl'>0</span>,  <span class='fl'>0</span>,  <span class='fl'>0</span>,  <span class='fl'>0.05</span><span class='op'>)</span></span>
<span><span class='va'>par</span>   <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>40</span>, <span class='fl'>190</span>, <span class='fl'>0.5</span>, <span class='fl'>25</span>, <span class='fl'>3372.8</span>,  <span class='fl'>9900.3</span>, <span class='fl'>6319.5</span>, <span class='fl'>5.939917e13</span>,    <span class='fl'>4</span>, <span class='fl'>36</span>,  <span class='fl'>4</span>,  <span class='fl'>1.60</span><span class='op'>)</span></span>
<span><span class='va'>upper</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>80</span>, <span class='fl'>500</span>, <span class='fl'>1.0</span>, <span class='fl'>30</span>, <span class='fl'>4000.0</span>, <span class='fl'>10000.0</span>, <span class='fl'>7000.0</span>,       <span class='fl'>6.e13</span>,   <span class='fl'>10</span>, <span class='fl'>40</span>, <span class='fl'>10</span>, <span class='fl'>50.00</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Run the fitter</span></span>
<span><span class='va'>pheno_fit</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/chillR/man/phenologyFitter.html'>phenologyFitter</a></span><span class='op'>(</span>par.guess <span class='op'>=</span> <span class='va'>par</span>,</span>
<span>                             modelfn <span class='op'>=</span> <span class='va'>PhenoFlex_GDHwrapper</span>,</span>
<span>                             bloomJDays <span class='op'>=</span> <span class='va'>pheno_merged</span><span class='op'>[</span><span class='va'>pheno_merged</span><span class='op'>$</span><span class='va'>Year</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span></span>
<span>                                                         <span class='va'>calibration_seasons</span>, <span class='st'>"pheno"</span><span class='op'>]</span>,</span>
<span>                             SeasonList <span class='op'>=</span> <span class='va'>weather_season_list</span>,</span>
<span>                             lower <span class='op'>=</span> <span class='va'>lower</span>,</span>
<span>                             upper <span class='op'>=</span> <span class='va'>upper</span>,</span>
<span>                             control <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>smooth <span class='op'>=</span> <span class='cn'>FALSE</span>,</span>
<span>                                            verbose <span class='op'>=</span> <span class='cn'>FALSE</span>,</span>
<span>                                            maxit <span class='op'>=</span> <span class='fl'>2000</span>,</span>
<span>                                            nb.stop.improvement <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Save the resulting parameters to folder (to avoid having to run the phenology fitter again)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.csv</a></span><span class='op'>(</span><span class='va'>pheno_fit</span><span class='op'>$</span><span class='va'>par</span>, <span class='st'>"data/PhenoFlex_hist_exp_pear.csv"</span>, row.names <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Save the results of the predicted phenology for the calibration seasons</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.csv</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='va'>pheno_merged</span><span class='op'>[</span><span class='va'>pheno_merged</span><span class='op'>$</span><span class='va'>Year</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='va'>calibration_seasons</span>, <span class='op'>]</span>,</span>
<span>                     <span class='st'>"Predicted"</span> <span class='op'>=</span> <span class='va'>pheno_fit</span><span class='op'>$</span><span class='va'>pbloomJDays</span><span class='op'>)</span>, <span class='st'>"data/PhenoFlex_hist_exp_predicted_bloom_pear.csv"</span>,</span>
<span>          row.names <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The results of the fitting procedure can now be examined. By using the fitted parameters in the model, the prediction error can be assessed by comparing the predicted bloom dates with the observed ones.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Read the parameters</span></span>
<span><span class='va'>params</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.csv</a></span><span class='op'>(</span><span class='st'>"data/PhenoFlex_hist_exp_pear.csv"</span><span class='op'>)</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span></span>
<span></span>
<span><span class='co'># Generate a data set to collect the outputs of the fitting for the calibration data </span></span>
<span><span class='va'>out_df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/chillR/man/read_tab.html'>read_tab</a></span><span class='op'>(</span><span class='st'>"data/PhenoFlex_hist_exp_predicted_bloom_pear.csv"</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Compute the error (observed - predicted)</span></span>
<span><span class='va'>out_df</span><span class='op'>[[</span><span class='st'>"Error"</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>out_df</span><span class='op'>$</span><span class='va'>pheno</span> <span class='op'>-</span> <span class='va'>out_df</span><span class='op'>$</span><span class='va'>Predicted</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>Model performance metrics can now be computed based on the estimated prediction errors. While not crucial during calibration, these metrics provide insight into the success of the calibration attempt.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>Although there is room for improvement—considering that only 10 iterations of the fitting procedure were used—the calibration still results in a relatively small RMSEP. A plot of the results will help visualize the overall performance.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Plot the results to see the overall fitting</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>out_df</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>pheno</span>, <span class='va'>Predicted</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_abline</a></span><span class='op'>(</span>intercept <span class='op'>=</span> <span class='fl'>0</span>, slope <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Observed"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
<p><img src="estimate_files/figure-html5/unnamed-chunk-11-1.png" width="624" /></p>
</div>
<p>This is a good initial calibration, but it may be worthwhile to test different <code>par.guess</code> values and adjust other arguments within <code>phenologyFitter()</code> to improve the model calibration.</p>
<h2 id="validation">Validation</h2>
<p>Next, the model’s ability to predict bloom dates for seasons outside the calibration dataset should be evaluated. This requires extracting the model parameters and using the <code>PhenoFlex_GDHwrapper()</code> function to perform the predictions.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Generate a validation data set with phenology data</span></span>
<span><span class='va'>valid_df</span> <span class='op'>&lt;-</span> <span class='va'>pheno_merged</span><span class='op'>[</span><span class='va'>pheno_merged</span><span class='op'>$</span><span class='va'>Year</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='va'>validation_seasons</span>, <span class='op'>]</span></span>
<span></span>
<span><span class='co'># Generate a list of seasons with weather data for the validation procedure</span></span>
<span><span class='va'>valid_season_list</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/chillR/man/genSeasonList.html'>genSeasonList</a></span><span class='op'>(</span><span class='va'>weather_merged</span>, mrange <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>9</span>, <span class='fl'>7</span><span class='op'>)</span>, </span>
<span>                                   years <span class='op'>=</span> <span class='va'>validation_seasons</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Estimate the bloom dates with PhenoFlexGDHwrapper</span></span>
<span><span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span> <span class='op'>:</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>valid_df</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  </span>
<span>  <span class='va'>valid_df</span><span class='op'>[</span><span class='va'>i</span>, <span class='st'>"Predicted"</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/chillR/man/PhenoFlex_GDHwrapper.html'>PhenoFlex_GDHwrapper</a></span><span class='op'>(</span><span class='va'>valid_season_list</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span>,</span>
<span>                                                   <span class='va'>params</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='co'># Compute the error (observed - predicted)</span></span>
<span><span class='va'>valid_df</span><span class='op'>[[</span><span class='st'>"Error"</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>valid_df</span><span class='op'>$</span><span class='va'>pheno</span> <span class='op'>-</span> <span class='va'>valid_df</span><span class='op'>$</span><span class='va'>Predicted</span></span></code></pre>
</div>
</div>
<p>Since the prediction error (the difference between observed and predicted values) in the validation dataset is known, model performance metrics such as RMSEP and RPIQ can be estimated. The <code>RMSEP()</code> and <code>RPIQ()</code> functions from the <code>chillR</code> package can be used for this purpose.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Metric</th>
<th style="text-align: right;">Calibration</th>
<th style="text-align: right;">Validation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">RMSEP</td>
<td style="text-align: right;">4.72</td>
<td style="text-align: right;">5.34</td>
</tr>
<tr class="even">
<td style="text-align: left;">RPIQ</td>
<td style="text-align: right;">4.50</td>
<td style="text-align: right;">4.12</td>
</tr>
</tbody>
</table>
</div>
<p>The table results suggest that the <code>PhenoFlex</code> model performs well in predicting pear tree bloom dates under future conditions. To enhance robustness, multiple <code>PhenoFlex</code> fittings should be conducted to lower RMSEP values. Additionally, reducing the number of experimental seasons may help minimize the influence of extreme values and narrow the range of observed conditions in the warmer part of the model’s validity domain.</p>
<p>Further errors may stem from merging datasets collected using different methodologies, such as mature orchard trees versus young potted trees, or variations in observers across experiments. The fitting outcomes are analyzed below, with labels marking seasons where the prediction error exceeds 10 days.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Plot the validation and calibration results (highlight seasons with 10 or more days of error)</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>out_df</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>pheno</span>, <span class='va'>Predicted</span>, color <span class='op'>=</span> <span class='st'>"Calibration"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>valid_df</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>pheno</span>, <span class='va'>Predicted</span>, color <span class='op'>=</span> <span class='st'>"Validation"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> </span>
<span>  <span class='fu'>ggrepel</span><span class='fu'>::</span><span class='fu'><a href='https://ggrepel.slowkow.com/reference/geom_text_repel.html'>geom_label_repel</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>pheno</span>, <span class='va'>Predicted</span>, label <span class='op'>=</span> <span class='va'>Year</span><span class='op'>)</span>,</span>
<span>                            data <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>out_df</span>, <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>Error</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>10</span><span class='op'>)</span>, nudge_y <span class='op'>=</span> <span class='fl'>2</span>, nudge_x <span class='op'>=</span> <span class='fl'>6</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggrepel</span><span class='fu'>::</span><span class='fu'><a href='https://ggrepel.slowkow.com/reference/geom_text_repel.html'>geom_label_repel</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>pheno</span>, <span class='va'>Predicted</span>, label <span class='op'>=</span> <span class='va'>Year</span><span class='op'>)</span>,</span>
<span>                            data <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>valid_df</span>, <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>Error</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>10</span><span class='op'>)</span>, nudge_y <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span>, nudge_x <span class='op'>=</span> <span class='fl'>9</span>, force <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_color_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"cadetblue"</span>, <span class='st'>"firebrick"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_abline</a></span><span class='op'>(</span>intercept <span class='op'>=</span> <span class='fl'>0</span>, slope <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Observed"</span>,</span>
<span>       color <span class='op'>=</span> <span class='st'>"Dataset"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
<p><img src="estimate_files/figure-html5/unnamed-chunk-16-1.png" width="624" /></p>
</div>
<p>If the validation approach is deemed satisfactory, the fitted parameters from previous model runs can be used to predict bloom dates under future scenarios. This involves utilizing the data from the <em>Future Temperature Scenarios</em> chapter, which has already been loaded into R for generating the convex-hull plots.</p>
<p>The function <code>PhenoFlex_GDHwrapper()</code> will be applied to estimate bloom dates under future conditions. The initial steps within the <em>for</em> loop ensure proper data formatting by deriving hourly temperature records with <code>stack_hourly_temps()</code> and defining the seasons using <code>genSeasonList()</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Create a primer data frame to allocate the results for future bloom</span></span>
<span><span class='va'>future_bloom</span> <span class='op'>&lt;-</span> <span class='va'>future_temps</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>SSP_Time</span>, </span>
<span>           <span class='va'>GCM</span>, </span>
<span>           <span class='va'>Year</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>Pheno <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Define the scenarios to be used in the for loop</span></span>
<span><span class='va'>scenarios</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>future_temps</span><span class='op'>$</span><span class='va'>SSP_Time</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Define the climate models to be used in the for loop</span></span>
<span><span class='va'>climate_models</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>future_temps</span><span class='op'>$</span><span class='va'>GCM</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Implement the for loop</span></span>
<span><span class='kw'>for</span> <span class='op'>(</span><span class='va'>scenario</span> <span class='kw'>in</span> <span class='va'>scenarios</span><span class='op'>)</span><span class='op'>{</span></span>
<span>  <span class='va'>scen_file</span> <span class='op'>&lt;-</span> <span class='va'>future_temps</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>SSP_Time</span> <span class='op'>==</span> <span class='va'>scenario</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='va'>climate_models</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>scen_file</span><span class='op'>$</span><span class='va'>GCM</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>climate_model</span> <span class='kw'>in</span> <span class='va'>climate_models</span><span class='op'>)</span><span class='op'>{</span></span>
<span>    </span>
<span>    <span class='co'># Subset a temporary data frame according to scenario and climate model</span></span>
<span>    <span class='co'># and generate hourly temperatures</span></span>
<span>    <span class='va'>temp_df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>scen_file</span>,</span>
<span>                      <span class='va'>GCM</span> <span class='op'>==</span> <span class='va'>climate_model</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>      <span class='fu'><a href='https://rdrr.io/pkg/chillR/man/stack_hourly_temps.html'>stack_hourly_temps</a></span><span class='op'>(</span>latitude <span class='op'>=</span> <span class='fl'>50.4</span><span class='op'>)</span></span>
<span>    </span>
<span>    <span class='co'># Define the saeasons to be used for predicting the phenology</span></span>
<span>    <span class='va'>temp_seasons_list</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/chillR/man/genSeasonList.html'>genSeasonList</a></span><span class='op'>(</span><span class='va'>temp_df</span><span class='op'>$</span><span class='va'>hourtemps</span>, </span>
<span>                                       mrange <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>9</span>, <span class='fl'>7</span><span class='op'>)</span>,</span>
<span>                                       years <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2002</span> <span class='op'>:</span> <span class='fl'>2101</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    </span>
<span>    <span class='co'># Change the names of the list of seasons to be used as index in the next for loop</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>temp_seasons_list</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fl'>2002</span> <span class='op'>:</span> <span class='fl'>2101</span></span>
<span>    </span>
<span>    <span class='co'># Implement a for loop that runs over the list of seasons to estimate the bloom date using the parameters fitted by the</span></span>
<span>    <span class='co'># model</span></span>
<span>    <span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span> <span class='op'>:</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>temp_seasons_list</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span></span>
<span>      </span>
<span>      <span class='co'># Add the bloom date to the primer data set</span></span>
<span>      <span class='va'>future_bloom</span><span class='op'>[</span><span class='va'>future_bloom</span><span class='op'>$</span><span class='va'>SSP_Time</span> <span class='op'>==</span> <span class='va'>scenario</span> <span class='op'>&amp;</span> </span>
<span>                     <span class='va'>future_bloom</span><span class='op'>$</span><span class='va'>GCM</span> <span class='op'>==</span> <span class='va'>climate_model</span> <span class='op'>&amp;</span> </span>
<span>                     <span class='va'>future_bloom</span><span class='op'>$</span><span class='va'>Year</span> <span class='op'>==</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>temp_seasons_list</span><span class='op'>)</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span>, </span>
<span>                   <span class='st'>"Pheno"</span><span class='op'>]</span> <span class='op'>&lt;-</span></span>
<span>        <span class='fu'><a href='https://rdrr.io/pkg/chillR/man/PhenoFlex_GDHwrapper.html'>PhenoFlex_GDHwrapper</a></span><span class='op'>(</span><span class='va'>temp_seasons_list</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span>,</span>
<span>                             <span class='va'>params</span><span class='op'>)</span></span>
<span>    <span class='op'>}</span></span>
<span>  <span class='op'>}</span></span>
<span><span class='op'>}</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>The same procedure can now be applied to estimate bloom dates for historically simulated scenarios.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Bloom for past simulated scenarios ####</span></span>
<span><span class='co'># Load the historical simulated scenarios</span></span>
<span><span class='va'>temps_past_scenarios</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/chillR/man/load_temperature_scenarios.html'>load_temperature_scenarios</a></span><span class='op'>(</span><span class='st'>"data"</span>,</span>
<span>                                    <span class='st'>"Bonn_hist_scenarios"</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Create a single dataset for all the simulated years</span></span>
<span><span class='va'>temps_past_scenarios</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind_rows.html'>bind_rows</a></span><span class='op'>(</span><span class='va'>temps_past_scenarios</span>,</span>
<span>                                  .id <span class='op'>=</span> <span class='st'>"Scen_year"</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Make a primer dataset to allocate the results of the bloom projection</span></span>
<span><span class='va'>simulated_bloom</span> <span class='op'>&lt;-</span> <span class='va'>temps_past_scenarios</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>Scen_year</span>, <span class='va'>Year</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>Pheno <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Define the scenario years to be used in the loop</span></span>
<span><span class='va'>scen_years</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>simulated_bloom</span><span class='op'>$</span><span class='va'>Scen_year</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Implement the for loop</span></span>
<span><span class='kw'>for</span> <span class='op'>(</span><span class='va'>scen_year</span> <span class='kw'>in</span> <span class='va'>scen_years</span><span class='op'>)</span><span class='op'>{</span></span>
<span>  </span>
<span>  <span class='co'># Subset a temporary data frame according to scenario and climate model</span></span>
<span>  <span class='va'>temp_df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>temps_past_scenarios</span>, </span>
<span>                    <span class='va'>Scen_year</span> <span class='op'>==</span> <span class='va'>scen_year</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='co'># Generate hourly temperatures in the temporary data frame</span></span>
<span>  <span class='va'>temp_df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/chillR/man/stack_hourly_temps.html'>stack_hourly_temps</a></span><span class='op'>(</span><span class='va'>temp_df</span>,</span>
<span>                                latitude <span class='op'>=</span> <span class='fl'>50.4</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='co'># Define the saeasons to be used for predicting the phenology</span></span>
<span>  <span class='va'>temp_seasons_list</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/chillR/man/genSeasonList.html'>genSeasonList</a></span><span class='op'>(</span><span class='va'>temp_df</span><span class='op'>$</span><span class='va'>hourtemps</span>, </span>
<span>                                     mrange <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>9</span>, <span class='fl'>7</span><span class='op'>)</span>, </span>
<span>                                     years <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2002</span> <span class='op'>:</span> <span class='fl'>2101</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='co'># Change the names of the list of seasons to be used as index in the next for loop</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>temp_seasons_list</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fl'>2002</span> <span class='op'>:</span> <span class='fl'>2101</span></span>
<span>  </span>
<span>  <span class='co'># Implement a for loop that runs over the list of seasons to estimate the bloom date using the parameters fitted by the</span></span>
<span>  <span class='co'># model</span></span>
<span>  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span> <span class='op'>:</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>temp_seasons_list</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span></span>
<span>    </span>
<span>    <span class='co'># Add the bloom date to the primer data set</span></span>
<span>    <span class='va'>simulated_bloom</span><span class='op'>[</span><span class='va'>simulated_bloom</span><span class='op'>$</span><span class='va'>Scen_year</span> <span class='op'>==</span> <span class='va'>scen_year</span> <span class='op'>&amp;</span> </span>
<span>                      <span class='va'>simulated_bloom</span><span class='op'>$</span><span class='va'>Year</span> <span class='op'>==</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>temp_seasons_list</span><span class='op'>)</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span>, </span>
<span>                    <span class='st'>"Pheno"</span><span class='op'>]</span> <span class='op'>&lt;-</span> </span>
<span>      <span class='fu'><a href='https://rdrr.io/pkg/chillR/man/PhenoFlex_GDHwrapper.html'>PhenoFlex_GDHwrapper</a></span><span class='op'>(</span><span class='va'>temp_seasons_list</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span>,</span>
<span>                                                                                                            <span class='va'>params</span><span class='op'>)</span></span>
<span>  <span class='op'>}</span></span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.csv</a></span><span class='op'>(</span><span class='va'>simulated_bloom</span>, <span class='st'>"data/frost_simulated_bloom.csv"</span>, row.names <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>A plot will now be created to illustrate likely bloom dates for historical and future scenarios, incorporating calibration data for the <code>PhenoFlex</code> model. Since the two datasets have different axes, the plotting process is complex and follows these steps:</p>
<ol type="1">
<li><p>Generate a violin plot for simulated bloom data from past scenarios.</p></li>
<li><p>Extract x and y axis limits using <code>layer_scales()</code>.</p></li>
<li><p>Create a density plot of calibration data (distinguishing between historical and experimental data) and extract its data using <code>ggplot_build()</code>.</p></li>
<li><p>Convert the extracted density data into numeric values that align with the year axis from the first plot.</p></li>
<li><p>Add this density data to the initial plot using <code>geom_ribbon()</code>.</p></li>
<li><p>Plot future bloom data separately.</p></li>
<li><p>Merge both plots using the <code>patchwork</code> package.</p></li>
<li><p>Save the final plot as an image with <code>ggsave()</code>.</p></li>
</ol>
<p>Despite necessary adjustments and challenges in aligning both datasets, the resulting visualization effectively presents the intended comparison.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Plot all bloom prediction results</span></span>
<span></span>
<span><span class='co'># Plot showing the violins for historical simulated scenarios</span></span>
<span><span class='va'>past_simulated_plot</span> <span class='op'>&lt;-</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>simulated_bloom</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_violin.html'>geom_violin</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Scen_year</span>,</span>
<span>        group <span class='op'>=</span> <span class='va'>Scen_year</span>, </span>
<span>        y <span class='op'>=</span> <span class='va'>Pheno</span><span class='op'>)</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>0.35</span>,</span>
<span>    draw_quantiles <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.25</span>, <span class='fl'>0.5</span>, <span class='fl'>0.75</span><span class='op'>)</span>,</span>
<span>    alpha <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_grid.html'>facet_grid</a></span><span class='op'>(</span><span class='op'>~</span> <span class='st'>"Historical"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.title.x<span class='op'>=</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>        axis.title.y<span class='op'>=</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>        plot.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"transparent"</span><span class='op'>)</span>,</span>
<span>        panel.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>        panel.grid <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>        aspect.ratio <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>past_xlim</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot_build.html'>layer_scales</a></span><span class='op'>(</span><span class='va'>past_simulated_plot</span><span class='op'>)</span><span class='op'>$</span><span class='va'>x</span><span class='op'>$</span><span class='va'>range</span><span class='op'>$</span><span class='va'>range</span></span>
<span><span class='va'>past_ylim</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot_build.html'>layer_scales</a></span><span class='op'>(</span><span class='va'>past_simulated_plot</span><span class='op'>)</span><span class='op'>$</span><span class='va'>y</span><span class='op'>$</span><span class='va'>range</span><span class='op'>$</span><span class='va'>range</span></span>
<span></span>
<span><span class='co'># Make a density plot to show the distribution of the seasons used for calibration of the PhenoFlex modelling framework</span></span>
<span><span class='co'># Create a dataframe with columns to be used in the plot</span></span>
<span><span class='va'>observed_bloom_calibration</span> <span class='op'>&lt;-</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='va'>out_df</span>,</span>
<span>             Facet <span class='op'>=</span> <span class='st'>"Past scenarios"</span>,</span>
<span>             Dataset <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>out_df</span><span class='op'>$</span><span class='va'>Year</span> <span class='op'>&gt;</span> <span class='fl'>2010</span>, </span>
<span>                               <span class='st'>"Experimental"</span>, </span>
<span>                               <span class='st'>"Historical"</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Make a density plot of the bloom dates included in the calibration dataset</span></span>
<span><span class='va'>gg_density_plot</span> <span class='op'>&lt;-</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_density.html'>geom_density</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>observed_bloom_calibration</span>,</span>
<span>               <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>pheno</span>, </span>
<span>                   fill <span class='op'>=</span> <span class='va'>Dataset</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='co'># Extract data from the plot</span></span>
<span><span class='va'>density_data</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>gg_density_plot</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot_build.html'>ggplot_build</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://purrr.tidyverse.org/reference/pluck.html'>pluck</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>:</span><span class='va'>y</span>,<span class='va'>group</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='co'># Scale data so that they can be plotted on the Year axis</span></span>
<span><span class='va'>density_data</span><span class='op'>[</span><span class='va'>density_data</span><span class='op'>$</span><span class='va'>group</span> <span class='op'>==</span> <span class='fl'>1</span>, <span class='st'>"Dataset"</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='st'>"Experimental"</span></span>
<span><span class='va'>density_data</span><span class='op'>[</span><span class='va'>density_data</span><span class='op'>$</span><span class='va'>group</span> <span class='op'>==</span> <span class='fl'>2</span>, <span class='st'>"Dataset"</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='st'>"Historical"</span></span>
<span><span class='va'>density_data</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>density_data</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>density_scaled <span class='op'>=</span> <span class='va'>x</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>,</span>
<span>         density_scaled <span class='op'>=</span> <span class='va'>density_scaled</span> <span class='op'>*</span> <span class='op'>(</span><span class='va'>past_xlim</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span> <span class='op'>-</span> </span>
<span>                                              <span class='va'>past_xlim</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>0.9</span> <span class='op'>+</span> <span class='va'>past_xlim</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># merge the two plots (and plot the violin plot again, so that it's placed</span></span>
<span><span class='co'># on top)</span></span>
<span></span>
<span><span class='va'>past_observed_plot</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>past_simulated_plot</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_ribbon.html'>geom_ribbon</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>density_data</span>,</span>
<span>            stat <span class='op'>=</span> <span class='st'>"identity"</span>,</span>
<span>            position <span class='op'>=</span> <span class='st'>"identity"</span>,</span>
<span>            <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>past_xlim</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,</span>
<span>                xmax <span class='op'>=</span> <span class='va'>density_scaled</span>,</span>
<span>                y <span class='op'>=</span> <span class='va'>y</span>,</span>
<span>                fill <span class='op'>=</span> <span class='va'>Dataset</span><span class='op'>)</span>,</span>
<span>         alpha <span class='op'>=</span> <span class='fl'>0.75</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_violin.html'>geom_violin</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>simulated_bloom</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Scen_year</span>,</span>
<span>        group <span class='op'>=</span> <span class='va'>Scen_year</span>, </span>
<span>        y <span class='op'>=</span> <span class='va'>Pheno</span><span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>0.35</span>,</span>
<span>    draw_quantiles <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.25</span>, <span class='fl'>0.5</span>, <span class='fl'>0.75</span><span class='op'>)</span>,</span>
<span>    alpha <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>10</span>,<span class='fl'>160</span><span class='op'>)</span>,</span>
<span>                     labels <span class='op'>=</span> <span class='kw'>function</span> <span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> </span>
<span>                       <span class='fu'><a href='https://rdrr.io/r/base/format.html'>format</a></span><span class='op'>(</span><span class='fu'>dormancyR</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/dormancyR/man/JDay_to_date.html'>JDay_to_date</a></span><span class='op'>(</span><span class='va'>x</span>, </span>
<span>                                                      <span class='fl'>2001</span>,</span>
<span>                                                      na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span>                              <span class='st'>"%b %d"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='fl'>0.1</span><span class='op'>)</span>,</span>
<span>        axis.text.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>8</span>, </span>
<span>                                   angle <span class='op'>=</span> <span class='fl'>45</span>,</span>
<span>                                   vjust <span class='op'>=</span> <span class='fl'>.4</span>, </span>
<span>                                   hjust <span class='op'>=</span> <span class='fl'>.6</span><span class='op'>)</span>,</span>
<span>        legend.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>6</span><span class='op'>)</span>,</span>
<span>        legend.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>8</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='co'># Create a violin plot to show future bloom dates</span></span>
<span><span class='va'>future_bloom_plot</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/na.fail.html'>na.omit</a></span><span class='op'>(</span><span class='va'>future_bloom</span><span class='op'>)</span>,</span>
<span>                            <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>GCM</span>, <span class='va'>Pheno</span>, fill <span class='op'>=</span> <span class='va'>GCM</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_violin.html'>geom_violin</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>0.35</span>,</span>
<span>              draw_quantiles <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.25</span>, <span class='fl'>0.75</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/stat_summary.html'>stat_summary</a></span><span class='op'>(</span>fun <span class='op'>=</span> <span class='st'>"median"</span>, </span>
<span>               geom <span class='op'>=</span> <span class='st'>"point"</span>,</span>
<span>               shape <span class='op'>=</span> <span class='fl'>4</span>,</span>
<span>               size <span class='op'>=</span> <span class='fl'>0.8</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>10</span>, <span class='fl'>160</span><span class='op'>)</span>,</span>
<span>                     labels <span class='op'>=</span> <span class='kw'>function</span> <span class='op'>(</span><span class='va'>x</span><span class='op'>)</span></span>
<span>                       <span class='fu'><a href='https://rdrr.io/r/base/format.html'>format</a></span><span class='op'>(</span><span class='fu'>dormancyR</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/dormancyR/man/JDay_to_date.html'>JDay_to_date</a></span><span class='op'>(</span><span class='va'>x</span>,</span>
<span>                                                      <span class='fl'>2001</span>,</span>
<span>                                                      na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>, </span>
<span>                              <span class='st'>"%b %d"</span><span class='op'>)</span><span class='op'>)</span>  <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_grid.html'>facet_grid</a></span><span class='op'>(</span><span class='op'>~</span> <span class='va'>SSP_Time</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"bottom"</span>,</span>
<span>        legend.key.size <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>0.4</span>, <span class='st'>"cm"</span><span class='op'>)</span>,</span>
<span>        legend.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>,</span>
<span>        axis.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>        axis.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>        axis.ticks <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span>       <span class='op'>)</span></span>
<span></span>
<span><span class='co'># Combine plots</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://patchwork.data-imaginist.com'>patchwork</a></span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>past_observed_plot</span> <span class='op'>+</span></span>
<span>             <span class='va'>future_bloom_plot</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Save the plot to the folder</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsave.html'>ggsave</a></span><span class='op'>(</span><span class='st'>"images/future_pheno_pear.png"</span>, </span>
<span>       device <span class='op'>=</span> <span class='st'>"png"</span>, </span>
<span>       width <span class='op'>=</span> <span class='fl'>19</span>, </span>
<span>       height <span class='op'>=</span> <span class='fl'>15</span>,</span>
<span>       units <span class='op'>=</span> <span class='st'>"cm"</span>, </span>
<span>       dpi <span class='op'>=</span> <span class='fl'>600</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p><img src="images/future_pheno_pear.png" /></p>
<p>The results indicate that bloom in pear cultivar ‘Conference’ is expected to occur slightly earlier under future climate scenarios. The next step is to assess the probability of frost events during the flowering period. To do this, a bloom period of 10 days around the predicted full bloom date for each simulated year will be considered, and temperature data during this period will be analyzed.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Frost risk part ####</span></span>
<span><span class='co'># Add the "buffer" around the estimated bloom dates to compute the number of hours below 0 °C in this period. Hypothetically, this represents the</span></span>
<span><span class='co'># period of bloom in all scenarios</span></span>
<span></span>
<span><span class='co'># Define the buffer only once</span></span>
<span><span class='va'>bloom_buffer</span> <span class='op'>&lt;-</span> <span class='fl'>5</span></span>
<span></span>
<span><span class='co'># Mutate the future bloom dataset to add the beggining and end for bloom</span></span>
<span><span class='va'>future_bloom</span> <span class='op'>&lt;-</span> <span class='va'>future_bloom</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>Beginning <span class='op'>=</span> <span class='va'>Pheno</span> <span class='op'>-</span> <span class='va'>bloom_buffer</span>,</span>
<span>         End <span class='op'>=</span> <span class='va'>Pheno</span> <span class='op'>+</span> <span class='va'>bloom_buffer</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Do the same with the observed bloom dataset (i.e. calibration)</span></span>
<span><span class='va'>observed_bloom_calibration</span> <span class='op'>&lt;-</span> <span class='va'>observed_bloom_calibration</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>Beginning <span class='op'>=</span> <span class='va'>pheno</span> <span class='op'>-</span> <span class='va'>bloom_buffer</span>,</span>
<span>         End <span class='op'>=</span> <span class='va'>pheno</span> <span class='op'>+</span> <span class='va'>bloom_buffer</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Same with the past simulated data from historical scenarios</span></span>
<span><span class='va'>simulated_bloom</span> <span class='op'>&lt;-</span> <span class='va'>simulated_bloom</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>Beginning <span class='op'>=</span> <span class='va'>Pheno</span> <span class='op'>-</span> <span class='va'>bloom_buffer</span>,</span>
<span>         End <span class='op'>=</span> <span class='va'>Pheno</span> <span class='op'>+</span> <span class='va'>bloom_buffer</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The number of frost hours expected under future and historical simulated scenarios will now be computed using multiple for loops. This approach will allow for a detailed assessment of frost risk during the bloom period across different climate conditions.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span> <span class='op'>:</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>observed_bloom_calibration</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span></span>
<span>  </span>
<span>  <span class='co'># Extract the beginning and end date for observed bloom</span></span>
<span>  <span class='va'>beg_bloom</span> <span class='op'>&lt;-</span> <span class='va'>observed_bloom_calibration</span><span class='op'>[</span><span class='va'>i</span>, <span class='st'>"Beginning"</span><span class='op'>]</span></span>
<span>  </span>
<span>  <span class='va'>end_bloom</span> <span class='op'>&lt;-</span> <span class='va'>observed_bloom_calibration</span><span class='op'>[</span><span class='va'>i</span>, <span class='st'>"End"</span><span class='op'>]</span></span>
<span>  </span>
<span>  <span class='co'># Subset a temporary dataframe of weather records for the year of interest</span></span>
<span>  <span class='va'>temp_df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>weather_merged</span>, </span>
<span>                    <span class='va'>Year</span> <span class='op'>==</span> <span class='va'>observed_bloom_calibration</span><span class='op'>[</span><span class='va'>i</span>, <span class='st'>"Year"</span><span class='op'>]</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='co'># Add the Julian date</span></span>
<span>  <span class='va'>temp_df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/chillR/man/make_JDay.html'>make_JDay</a></span><span class='op'>(</span><span class='va'>temp_df</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='co'># Filter only the period for bloom</span></span>
<span>  <span class='va'>temp_df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>temp_df</span>,</span>
<span>                    <span class='va'>JDay</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>beg_bloom</span> <span class='op'>:</span> <span class='va'>end_bloom</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='co'># Calculate the number of hours below 0 °C</span></span>
<span>  <span class='va'>frost_hours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='fu'>dormancyR</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/dormancyR/man/frost_risk.html'>frost_risk</a></span><span class='op'>(</span><span class='va'>temp_df</span><span class='op'>$</span><span class='va'>Temp</span>, </span>
<span>                                           threshold <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='co'># Add the number of hours to the original dataframe</span></span>
<span>  <span class='va'>observed_bloom_calibration</span><span class='op'>[</span><span class='va'>i</span>, <span class='st'>"Frost"</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>frost_hours</span></span>
<span>  </span>
<span><span class='op'>}</span></span></code></pre>
</div>
</div>
<p>The same procedure is applied to both past simulated and future scenarios.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Make a primer dataset to allocate the results of the frost projections</span></span>
<span><span class='va'>simulated_frost</span> <span class='op'>&lt;-</span> <span class='va'>temps_past_scenarios</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>Scen_year</span>, <span class='va'>Year</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>Frost <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Implement the loop over scenario years and simulated years </span></span>
<span><span class='kw'>for</span> <span class='op'>(</span><span class='va'>scen_year</span> <span class='kw'>in</span> <span class='va'>scen_years</span><span class='op'>)</span></span>
<span>  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>year</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2002</span> <span class='op'>:</span> <span class='fl'>2100</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span></span>
<span>    </span>
<span>    <span class='kw'>if</span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>simulated_bloom</span>, </span>
<span>                     <span class='va'>Scen_year</span> <span class='op'>==</span> <span class='va'>scen_year</span> <span class='op'>&amp;</span> </span>
<span>                     <span class='va'>Year</span> <span class='op'>==</span> <span class='va'>year</span><span class='op'>)</span><span class='op'>[[</span><span class='st'>"Pheno"</span><span class='op'>]</span><span class='op'>]</span>   <span class='op'>)</span><span class='op'>)</span></span>
<span>      <span class='op'>{</span></span>
<span>      </span>
<span>      <span class='co'># Extract the beginning and end of the blooming period</span></span>
<span>      <span class='va'>beg_bloom</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/na.fail.html'>na.omit</a></span><span class='op'>(</span><span class='va'>simulated_bloom</span><span class='op'>)</span>, </span>
<span>                          <span class='va'>Scen_year</span> <span class='op'>==</span> <span class='va'>scen_year</span> <span class='op'>&amp;</span> </span>
<span>                            <span class='va'>Year</span> <span class='op'>==</span> <span class='va'>year</span><span class='op'>)</span><span class='op'>[[</span><span class='st'>"Beginning"</span><span class='op'>]</span><span class='op'>]</span></span>
<span>      </span>
<span>      <span class='va'>beg_bloom</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>trunc</a></span><span class='op'>(</span><span class='va'>beg_bloom</span><span class='op'>)</span></span>
<span>      </span>
<span>      <span class='va'>end_bloom</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/na.fail.html'>na.omit</a></span><span class='op'>(</span><span class='va'>simulated_bloom</span><span class='op'>)</span>, </span>
<span>                          <span class='va'>Scen_year</span> <span class='op'>==</span> <span class='va'>scen_year</span>, </span>
<span>                          <span class='va'>Year</span> <span class='op'>==</span> <span class='va'>year</span><span class='op'>)</span><span class='op'>[[</span><span class='st'>"End"</span><span class='op'>]</span><span class='op'>]</span></span>
<span>      </span>
<span>      <span class='va'>end_bloom</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>trunc</a></span><span class='op'>(</span><span class='va'>end_bloom</span><span class='op'>)</span></span>
<span>      </span>
<span>      <span class='co'># Filter the weather data according to the relevant scenario year and simulated year</span></span>
<span>      </span>
<span>      <span class='va'>temp_df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>temps_past_scenarios</span>, </span>
<span>                        <span class='va'>Scen_year</span> <span class='op'>==</span> <span class='va'>scen_year</span> <span class='op'>&amp;</span></span>
<span>                          <span class='va'>Year</span> <span class='op'>==</span> <span class='va'>year</span><span class='op'>)</span></span>
<span>      </span>
<span>      <span class='co'># Derive hourly temperatures based on the latitude of Campus Klein-Altendorf</span></span>
<span>      <span class='va'>temp_df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/chillR/man/stack_hourly_temps.html'>stack_hourly_temps</a></span><span class='op'>(</span><span class='va'>temp_df</span>,</span>
<span>                                    latitude <span class='op'>=</span> <span class='fl'>50.4</span><span class='op'>)</span><span class='op'>[[</span><span class='st'>"hourtemps"</span><span class='op'>]</span><span class='op'>]</span></span>
<span>      </span>
<span>      <span class='co'># Filter the relevant period when bloom is likely to occurs</span></span>
<span>      </span>
<span>      <span class='va'>temp_df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>temp_df</span>, </span>
<span>                        <span class='va'>JDay</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>beg_bloom</span> <span class='op'>:</span> <span class='va'>end_bloom</span><span class='op'>)</span><span class='op'>)</span></span>
<span>      </span>
<span>      <span class='co'># Compute the number of frost hours</span></span>
<span>      <span class='va'>frost_hours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='fu'>dormancyR</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/dormancyR/man/frost_risk.html'>frost_risk</a></span><span class='op'>(</span><span class='va'>temp_df</span><span class='op'>$</span><span class='va'>Temp</span>, </span>
<span>                                               threshold <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span></span>
<span>      <span class='op'>}</span> <span class='kw'>else</span> <span class='va'>frost_hours</span> <span class='op'>&lt;-</span> <span class='fl'>0</span></span>
<span>      </span>
<span>      <span class='co'># Add the number of frost events to the primer dataset</span></span>
<span>      </span>
<span>      <span class='va'>simulated_frost</span><span class='op'>[</span><span class='va'>simulated_frost</span><span class='op'>$</span><span class='va'>Scen_year</span> <span class='op'>==</span> <span class='va'>scen_year</span> <span class='op'>&amp;</span> </span>
<span>                      <span class='va'>simulated_frost</span><span class='op'>$</span><span class='va'>Year</span> <span class='op'>==</span> <span class='va'>year</span>, <span class='st'>"Frost"</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>frost_hours</span></span>
<span></span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='co'># Remove NA cells since the first year has no bloom</span></span>
<span><span class='va'>simulated_frost</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/na.fail.html'>na.omit</a></span><span class='op'>(</span><span class='va'>simulated_frost</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>Next, the future scenarios are processed using the same methodology.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Create a primer data frame to allocate the results for future bloom</span></span>
<span><span class='va'>future_frost</span> <span class='op'>&lt;-</span> <span class='va'>future_temps</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>SSP_Time</span>, <span class='va'>GCM</span>, <span class='va'>Year</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>Frost <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Implement the for loop</span></span>
<span><span class='kw'>for</span> <span class='op'>(</span><span class='va'>scenario</span> <span class='kw'>in</span> <span class='va'>scenarios</span><span class='op'>)</span></span>
<span>    <span class='op'>{</span><span class='va'>scen_file</span> <span class='op'>&lt;-</span> <span class='va'>future_bloom</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>SSP_Time</span> <span class='op'>==</span> <span class='va'>scenario</span><span class='op'>)</span></span>
<span>    <span class='va'>climate_models</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>scen_file</span><span class='op'>$</span><span class='va'>GCM</span><span class='op'>)</span></span>
<span>    </span>
<span>    <span class='kw'>for</span> <span class='op'>(</span><span class='va'>climate_model</span> <span class='kw'>in</span> <span class='va'>climate_models</span><span class='op'>)</span></span>
<span>      <span class='kw'>for</span> <span class='op'>(</span><span class='va'>year</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2002</span> <span class='op'>:</span> <span class='fl'>2100</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span></span>
<span>      </span>
<span>        <span class='kw'>if</span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>scen_file</span>,</span>
<span>                         <span class='va'>GCM</span> <span class='op'>==</span> <span class='va'>climate_model</span> <span class='op'>&amp;</span> </span>
<span>                         <span class='va'>Year</span> <span class='op'>==</span> <span class='va'>year</span><span class='op'>)</span><span class='op'>[[</span><span class='st'>"Pheno"</span><span class='op'>]</span><span class='op'>]</span>   <span class='op'>)</span><span class='op'>)</span></span>
<span>        <span class='op'>{</span></span>
<span>          <span class='va'>beg_bloom</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/na.fail.html'>na.omit</a></span><span class='op'>(</span><span class='va'>scen_file</span><span class='op'>)</span>,</span>
<span>                              <span class='va'>GCM</span> <span class='op'>==</span> <span class='va'>climate_model</span> <span class='op'>&amp;</span></span>
<span>                                <span class='va'>Year</span> <span class='op'>==</span> <span class='va'>year</span><span class='op'>)</span><span class='op'>[[</span><span class='st'>"Beginning"</span><span class='op'>]</span><span class='op'>]</span></span>
<span>          </span>
<span>          <span class='va'>beg_bloom</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>trunc</a></span><span class='op'>(</span><span class='va'>beg_bloom</span><span class='op'>)</span></span>
<span>          </span>
<span>          <span class='va'>end_bloom</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/na.fail.html'>na.omit</a></span><span class='op'>(</span><span class='va'>scen_file</span><span class='op'>)</span>,</span>
<span>                              <span class='va'>GCM</span> <span class='op'>==</span> <span class='va'>climate_model</span> <span class='op'>&amp;</span></span>
<span>                                <span class='va'>Year</span> <span class='op'>==</span> <span class='va'>year</span><span class='op'>)</span><span class='op'>[[</span><span class='st'>"End"</span><span class='op'>]</span><span class='op'>]</span></span>
<span>          </span>
<span>          <span class='va'>end_bloom</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>trunc</a></span><span class='op'>(</span><span class='va'>end_bloom</span><span class='op'>)</span></span>
<span>          </span>
<span>          <span class='co'># Derive hourly temperatures based on the latitude of Campus Klein-Altendorf</span></span>
<span>          </span>
<span>          <span class='va'>temp_df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>future_temps</span>,</span>
<span>                            <span class='va'>SSP_Time</span> <span class='op'>==</span> <span class='va'>scenario</span> <span class='op'>&amp;</span> </span>
<span>                              <span class='va'>GCM</span> <span class='op'>==</span> <span class='va'>climate_model</span> <span class='op'>&amp;</span></span>
<span>                              <span class='va'>Year</span> <span class='op'>==</span> <span class='va'>year</span><span class='op'>)</span></span>
<span>          </span>
<span>          <span class='va'>temp_df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/chillR/man/stack_hourly_temps.html'>stack_hourly_temps</a></span><span class='op'>(</span><span class='va'>temp_df</span>,</span>
<span>                                        latitude <span class='op'>=</span> <span class='fl'>50.4</span><span class='op'>)</span><span class='op'>[[</span><span class='st'>"hourtemps"</span><span class='op'>]</span><span class='op'>]</span></span>
<span>          </span>
<span>          <span class='va'>temp_df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>temp_df</span>,</span>
<span>                            <span class='va'>JDay</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>beg_bloom</span> <span class='op'>:</span> <span class='va'>end_bloom</span><span class='op'>)</span><span class='op'>)</span></span>
<span>          </span>
<span>          <span class='va'>frost_hours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='fu'>dormancyR</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/dormancyR/man/frost_risk.html'>frost_risk</a></span><span class='op'>(</span><span class='va'>temp_df</span><span class='op'>$</span><span class='va'>Temp</span>,</span>
<span>                                                   threshold <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span></span>
<span>          <span class='op'>}</span> <span class='kw'>else</span> <span class='va'>frost_hours</span> <span class='op'>&lt;-</span> <span class='fl'>0</span></span>
<span>          </span>
<span>          <span class='va'>future_frost</span><span class='op'>[</span><span class='va'>future_frost</span><span class='op'>$</span><span class='va'>SSP_Time</span> <span class='op'>==</span> <span class='va'>scenario</span> <span class='op'>&amp;</span> </span>
<span>                         <span class='va'>future_frost</span><span class='op'>$</span><span class='va'>GCM</span> <span class='op'>==</span> <span class='va'>climate_model</span> <span class='op'>&amp;</span></span>
<span>                         <span class='va'>future_frost</span><span class='op'>$</span><span class='va'>Year</span> <span class='op'>==</span> <span class='va'>year</span>, <span class='st'>"Frost"</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>frost_hours</span></span>
<span>      <span class='op'>}</span></span>
<span>    <span class='op'>}</span></span>
<span><span class='co'># Remove NA cells since the first year has no bloom</span></span>
<span><span class='va'>future_frost</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/na.fail.html'>na.omit</a></span><span class='op'>(</span><span class='va'>future_frost</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>Now, the results are visualized using a standard approach for displaying agro-climatic projections. Two separate plots are generated—one for past simulated scenarios and one for future projections—and then combined using the patchwork package to provide a comprehensive overview of frost risk trends.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Plots</span></span>
<span><span class='va'>past_frost_plot</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>simulated_frost</span>,</span>
<span>                          <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>Scen_year</span>, </span>
<span>                              <span class='va'>Frost</span>,</span>
<span>                              group <span class='op'>=</span> <span class='va'>Scen_year</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_boxplot.html'>geom_boxplot</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"cadetblue"</span>,</span>
<span>               outlier.size <span class='op'>=</span> <span class='fl'>0.8</span>, </span>
<span>               outlier.alpha <span class='op'>=</span> <span class='fl'>0.5</span>, </span>
<span>               outlier.shape <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='co'>#geom_point(data = observed_bloom_calibration, aes(as.character(Year), Frost)) +</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>90</span><span class='op'>)</span>, </span>
<span>                     expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Year"</span>,</span>
<span>       y <span class='op'>=</span> <span class='st'>"Spring frost (hours &lt;0 °C)"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_grid.html'>facet_grid</a></span><span class='op'>(</span><span class='op'>~</span> <span class='st'>"Historical"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.text.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>7</span>, </span>
<span>                                   angle <span class='op'>=</span> <span class='fl'>60</span>, </span>
<span>                                   hjust <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>future_frost_plot</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>future_frost</span>,</span>
<span>                            <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>GCM</span>, </span>
<span>                                <span class='va'>Frost</span>, </span>
<span>                                fill <span class='op'>=</span> <span class='va'>GCM</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_boxplot.html'>geom_boxplot</a></span><span class='op'>(</span>outlier.size <span class='op'>=</span> <span class='fl'>0.8</span>, </span>
<span>               outlier.alpha <span class='op'>=</span> <span class='fl'>0.5</span>, </span>
<span>               outlier.shape <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>90</span><span class='op'>)</span>,</span>
<span>                     expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_grid.html'>facet_grid</a></span><span class='op'>(</span><span class='op'>~</span> <span class='va'>SSP_Time</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>        axis.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>        axis.ticks <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>        legend.position <span class='op'>=</span> <span class='st'>"bottom"</span>,</span>
<span>        legend.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>7.5</span><span class='op'>)</span>,</span>
<span>        legend.key.size <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>0.3</span>, <span class='st'>"cm"</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>past_frost_plot</span> <span class='op'>+</span> </span>
<span>  <span class='va'>future_frost_plot</span> <span class='op'>+</span> </span>
<span>  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_layout.html'>plot_layout</a></span><span class='op'>(</span>widths <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.25</span>, <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
<p><img src="estimate_files/figure-html5/unnamed-chunk-30-1.png" width="624" /></p>
</div>
<p>An interesting observation is the high number of outliers present in each simulated scenario. Despite projections indicating an earlier bloom period for pear cv. Conference under future climate scenarios, the overall trend suggests a slight decline in the risk of spring frost events.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
